# ğŸ‰ é¡¹ç›®å®ç°å®Œæˆï¼

## âœ… å®ç°çŠ¶æ€

æ ¹æ® `DESIGN_DOCUMENT.md` æŠ€æœ¯æ–¹æ¡ˆï¼Œ**æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å·²å®Œæ•´å®ç°**ï¼

### å·²å®Œæˆçš„åŠŸèƒ½æ¨¡å—

#### âœ… 1. ç”¨æˆ·ç®¡ç†æ¨¡å—
- [x] ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€è®¤è¯
- [x] JWT Token è®¤è¯æœºåˆ¶
- [x] ç”¨æˆ·æƒé™ç®¡ç†

#### âœ… 2. åº”ç”¨ç®¡ç†æ¨¡å—
- [x] åº”ç”¨åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤
- [x] åº”ç”¨é…ç½®ï¼ˆæ¨¡å‹é€‰æ‹©ã€å‚æ•°è®¾ç½®ï¼‰
- [x] æç¤ºè¯æ¨¡æ¿ç®¡ç†
- [x] åº”ç”¨å‘å¸ƒ/è‰ç¨¿çŠ¶æ€ç®¡ç†
- [x] **åº”ç”¨ä½œä¸ºå¯é€‰é…ç½®æ¨¡æ¿ï¼Œä¸å¼ºåˆ¶ç»‘å®š**

#### âœ… 3. ä¼šè¯ç®¡ç†æ¨¡å—ï¼ˆç‹¬ç«‹æ¶æ„ï¼‰
- [x] é€šç”¨çš„å¤šè½®å¯¹è¯ç®¡ç†ï¼Œä¸ä¾èµ–åº”ç”¨
- [x] ä¼šè¯å†å²è®°å½•
- [x] ä¸Šä¸‹æ–‡ç»´æŠ¤
- [x] ä¼šè¯åˆ—è¡¨æŸ¥è¯¢
- [x] æ”¯æŒçµæ´»æŒ‡å®šæ¨¡å‹å’Œå‚æ•°

#### âœ… 4. æ¶ˆæ¯ç®¡ç†æ¨¡å—
- [x] æ¶ˆæ¯å‘é€ä¸æ¥æ”¶
- [x] æµå¼å“åº”æ”¯æŒï¼ˆSSEï¼‰
- [x] æ¶ˆæ¯å†å²æŸ¥è¯¢
- [x] æ¶ˆæ¯è¯„ä»·åé¦ˆ

#### âœ… 5. æ¨¡å‹ç®¡ç†æ¨¡å—
- [x] å¤šæ¨¡å‹æ”¯æŒï¼ˆOpenAIã€é€šä¹‰åƒé—®ã€DeepSeekã€ç¡…åŸºæµåŠ¨ï¼‰
- [x] æ¨¡å‹å‚æ•°é…ç½®
- [x] API Key ç®¡ç†ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰

#### âœ… 6. æ ¸å¿ƒç‰¹æ€§
- [x] ç‹¬ç«‹ä¼šè¯æ¶æ„
- [x] ä¸‰çº§é…ç½®ä¼˜å…ˆçº§ï¼ˆè¯·æ±‚çº§ > åº”ç”¨çº§ > ç”¨æˆ·é»˜è®¤çº§ï¼‰
- [x] å¤šå¹³å° AI æ¨¡å‹ç»Ÿä¸€é€‚é…
- [x] æµå¼å“åº”ï¼ˆSSEï¼‰
- [x] Redis ç¼“å­˜
- [x] å®Œæ•´çš„é”™è¯¯å¤„ç†
- [x] API æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### æ–¹å¼ä¸€ï¼šä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰

```bash
./start.sh
```

é€‰æ‹©å¯åŠ¨æ–¹å¼ï¼š
1. Docker Composeï¼ˆæ¨èï¼Œä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼‰
2. æœ¬åœ°å¼€å‘æ¨¡å¼
3. ä»…å¯åŠ¨æ•°æ®åº“æœåŠ¡

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨å¯åŠ¨

#### ä½¿ç”¨ Docker Compose

```bash
# 1. é…ç½®ç¯å¢ƒå˜é‡
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„ API Keys

# 2. å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# 3. è¿è¡Œæ•°æ®åº“è¿ç§»
docker-compose exec api alembic upgrade head

# 4. è®¿é—® API æ–‡æ¡£
open http://localhost:8000/docs
```

#### æœ¬åœ°å¼€å‘

```bash
# 1. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 2. å¯åŠ¨æ•°æ®åº“ï¼ˆPostgreSQL + Redisï¼‰
# ä½¿ç”¨ Docker æˆ–æœ¬åœ°å®‰è£…

# 3. è¿è¡Œè¿ç§»
alembic upgrade head

# 4. å¯åŠ¨æœåŠ¡
uvicorn app.main:app --reload --port 8000
```

## ğŸ“– æ–‡æ¡£

- **æŠ€æœ¯æ–¹æ¡ˆ**: [DESIGN_DOCUMENT.md](DESIGN_DOCUMENT.md) - å®Œæ•´çš„æŠ€æœ¯è®¾è®¡
- **å¿«é€Ÿå¼€å§‹**: [QUICKSTART.md](QUICKSTART.md) - è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—
- **é¡¹ç›®æ€»ç»“**: [PROJECT_SUMMARY.md](PROJECT_SUMMARY.md) - åŠŸèƒ½æ¸…å•
- **API æ–‡æ¡£**: http://localhost:8000/docs - è‡ªåŠ¨ç”Ÿæˆçš„äº¤äº’å¼æ–‡æ¡£

## ğŸ¯ æ ¸å¿ƒè®¾è®¡äº®ç‚¹

### 1. ç‹¬ç«‹ä¼šè¯æ¶æ„ ğŸŒŸ

```
ä¼ ç»Ÿè®¾è®¡ï¼šåº”ç”¨ â†’ ä¼šè¯ â†’ æ¶ˆæ¯ï¼ˆç»‘å®šå›ºå®šæ¨¡å‹ï¼‰
æœ¬ç³»ç»Ÿï¼š  ä¼šè¯ï¼ˆç‹¬ç«‹ï¼‰â†’ æ¶ˆæ¯ï¼ˆæ¯æ¡å¯ç”¨ä¸åŒæ¨¡å‹ï¼‰
```

**ä¼˜åŠ¿**ï¼š
- âœ… ä¼šè¯ä¸ä¾èµ–åº”ç”¨ï¼Œå¯åœ¨ä»»ä½•åœºæ™¯ä½¿ç”¨
- âœ… æ”¯æŒåŒä¸€ä¼šè¯ä½¿ç”¨å¤šä¸ªä¸åŒæ¨¡å‹
- âœ… çµæ´»çš„é…ç½®ç»§æ‰¿æœºåˆ¶

### 2. ä¸‰çº§é…ç½®ä¼˜å…ˆçº§ ğŸšï¸

```
1. è¯·æ±‚çº§ï¼ˆæœ€é«˜ï¼‰â†’ å‘é€æ¶ˆæ¯æ—¶ç›´æ¥æŒ‡å®š
2. åº”ç”¨æ¨¡æ¿çº§    â†’ å¼•ç”¨åº”ç”¨é…ç½®ï¼ˆå¯é€‰ï¼‰
3. ç”¨æˆ·é»˜è®¤çº§    â†’ ä½¿ç”¨é»˜è®¤é…ç½®
```

### 3. å¤šå¹³å°ç»Ÿä¸€é€‚é… ğŸ”Œ

æ”¯æŒçš„å¹³å°ï¼š
- âœ… OpenAIï¼ˆGPT-3.5, GPT-4ï¼‰
- âœ… é€šä¹‰åƒé—®ï¼ˆQwenï¼‰
- âœ… DeepSeek
- âœ… ç¡…åŸºæµåŠ¨ï¼ˆSiliconFlowï¼‰

ç»Ÿä¸€è°ƒç”¨æ¥å£ï¼š
```python
AIModelService.chat(
    provider="openai",  # æˆ–å…¶ä»–å¹³å°
    model="gpt-3.5-turbo",
    messages=[...],
    stream=True  # æ”¯æŒæµå¼
)
```

## ğŸ“Š é¡¹ç›®ç»“æ„

```
medical_project/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py              # FastAPI å…¥å£
â”‚   â”œâ”€â”€ core/                # æ ¸å¿ƒé…ç½®
â”‚   â”œâ”€â”€ models/              # æ•°æ®åº“æ¨¡å‹
â”‚   â”œâ”€â”€ schemas/             # Pydantic æ¨¡å‹
â”‚   â”œâ”€â”€ api/v1/              # API è·¯ç”±
â”‚   â”œâ”€â”€ services/            # ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ middleware/          # ä¸­é—´ä»¶
â”œâ”€â”€ alembic/                 # æ•°æ®åº“è¿ç§»
â”œâ”€â”€ tests/                   # æµ‹è¯•
â”œâ”€â”€ docker-compose.yml       # Docker é…ç½®
â”œâ”€â”€ requirements.txt         # Python ä¾èµ–
â””â”€â”€ .env                     # ç¯å¢ƒå˜é‡
```

## ğŸ” é…ç½®è¯´æ˜

### å¿…é¡»é…ç½®

åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®ï¼š

```bash
# 1. å®‰å…¨å¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ï¼‰
SECRET_KEY=your-secret-key-change-in-production
ENCRYPTION_KEY=your-encryption-key-32-chars!!
JWT_SECRET_KEY=your-jwt-secret-key

# 2. æ•°æ®åº“è¿æ¥
DATABASE_URL=postgresql+asyncpg://user:pass@localhost:5432/medical_db

# 3. Redis è¿æ¥
REDIS_URL=redis://localhost:6379/0

# 4. AI æ¨¡å‹ API Keysï¼ˆè‡³å°‘é…ç½®ä¸€ä¸ªï¼‰
OPENAI_API_KEY=sk-your-openai-key
DASHSCOPE_API_KEY=sk-your-qwen-key
DEEPSEEK_API_KEY=sk-your-deepseek-key
SILICONFLOW_API_KEY=sk-your-siliconflow-key
```

### å¯é€‰é…ç½®

```bash
# CORS é…ç½®
CORS_ORIGINS=["http://localhost:3000"]

# æ–‡ä»¶ä¸Šä¼ é™åˆ¶
MAX_UPLOAD_SIZE=10485760

# é™æµé…ç½®
RATE_LIMIT_PER_MINUTE=60
```

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### 1. æ³¨å†Œå’Œç™»å½•

```bash
# æ³¨å†Œ
curl -X POST "http://localhost:8000/api/v1/auth/register" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user@example.com",
    "username": "testuser",
    "password": "password123"
  }'

# ç™»å½•è·å– Token
curl -X POST "http://localhost:8000/api/v1/auth/login" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "password123"
  }'
```

### 2. é…ç½®æ¨¡å‹

```bash
TOKEN="your_token_here"

# æ·»åŠ  OpenAI é…ç½®
curl -X POST "http://localhost:8000/api/v1/models" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "provider": "openai",
    "model_name": "gpt-3.5-turbo",
    "api_key": "sk-your-key",
    "is_default": true,
    "config": {
      "temperature": 0.7,
      "max_tokens": 2000
    }
  }'
```

### 3. åˆ›å»ºä¼šè¯å¹¶å¯¹è¯

```bash
# åˆ›å»ºä¼šè¯
curl -X POST "http://localhost:8000/api/v1/conversations" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"title": "æˆ‘çš„å¯¹è¯"}'

# å‘é€æ¶ˆæ¯ï¼ˆä½¿ç”¨é»˜è®¤æ¨¡å‹ï¼‰
CONV_ID="conversation_id"
curl -X POST "http://localhost:8000/api/v1/conversations/$CONV_ID/messages" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"content": "ä½ å¥½"}'

# æµå¼å“åº”
curl -X POST "http://localhost:8000/api/v1/conversations/$CONV_ID/messages/stream" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"content": "ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±"}'
```

## ğŸ”§ è¿ç»´ç®¡ç†

### æŸ¥çœ‹æ—¥å¿—

```bash
# Docker æ—¥å¿—
docker-compose logs -f api

# æœ¬åœ°æ—¥å¿—
tail -f logs/app_*.log
tail -f logs/error_*.log
```

### æ•°æ®åº“ç®¡ç†

```bash
# åˆ›å»ºæ–°è¿ç§»
alembic revision --autogenerate -m "æè¿°"

# æ‰§è¡Œè¿ç§»
alembic upgrade head

# å›æ»šè¿ç§»
alembic downgrade -1
```

### åœæ­¢æœåŠ¡

```bash
# Docker Compose
docker-compose down

# æ¸…é™¤æ•°æ®
docker-compose down -v
```

## ğŸ“ å­¦ä¹ èµ„æº

### API æ–‡æ¡£
è®¿é—® http://localhost:8000/docs æŸ¥çœ‹å®Œæ•´çš„äº¤äº’å¼ API æ–‡æ¡£

### ä»£ç ç¤ºä¾‹
- æŸ¥çœ‹ `QUICKSTART.md` äº†è§£è¯¦ç»†ä½¿ç”¨åœºæ™¯
- æŸ¥çœ‹ `DESIGN_DOCUMENT.md` äº†è§£ç³»ç»Ÿè®¾è®¡

### æ ¸å¿ƒä»£ç 
- `app/services/ai_service.py` - AI æ¨¡å‹é€‚é…å±‚
- `app/services/message_service.py` - æ¶ˆæ¯å¤„ç†é€»è¾‘
- `app/api/v1/` - API è·¯ç”±å®ç°

## âš ï¸ æ³¨æ„äº‹é¡¹

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

1. **ä¿®æ”¹æ‰€æœ‰å¯†é’¥**ï¼š`.env` ä¸­çš„ SECRET_KEYã€JWT_SECRET_KEY ç­‰
2. **é…ç½® HTTPS**ï¼šä½¿ç”¨ Nginx åå‘ä»£ç†
3. **æ•°æ®åº“å¤‡ä»½**ï¼šé…ç½® PostgreSQL å®šæœŸå¤‡ä»½
4. **ç›‘æ§å‘Šè­¦**ï¼šæ·»åŠ æ—¥å¿—ç›‘æ§å’Œé”™è¯¯å‘Šè­¦
5. **é™æµé…ç½®**ï¼šæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´é™æµå‚æ•°

### å®‰å…¨å»ºè®®

- âœ… API Key å·²åŠ å¯†å­˜å‚¨
- âœ… å¯†ç ä½¿ç”¨ bcrypt åŠ å¯†
- âœ… JWT Token è®¤è¯
- âš ï¸ ç”Ÿäº§ç¯å¢ƒåŠ¡å¿…ä½¿ç”¨ HTTPS
- âš ï¸ å®šæœŸæ›´æ–°ä¾èµ–åŒ…

## ğŸ¤ æŠ€æœ¯æ”¯æŒ

### é—®é¢˜æ’æŸ¥

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   - æ£€æŸ¥ PostgreSQL æ˜¯å¦è¿è¡Œ
   - éªŒè¯ DATABASE_URL é…ç½®

2. **Redis è¿æ¥å¤±è´¥**
   - æ£€æŸ¥ Redis æ˜¯å¦è¿è¡Œ
   - éªŒè¯ REDIS_URL é…ç½®

3. **AI è°ƒç”¨å¤±è´¥**
   - æ£€æŸ¥ API Key æ˜¯å¦æ­£ç¡®
   - æŸ¥çœ‹é”™è¯¯æ—¥å¿—

### å¸¸è§é—®é¢˜

Q: å¦‚ä½•æ·»åŠ æ–°çš„ AI æ¨¡å‹å¹³å°ï¼Ÿ
A: åœ¨ `app/services/ai_service.py` ä¸­åˆ›å»ºæ–°çš„ Provider ç±»

Q: å¦‚ä½•ä¿®æ”¹ Token è¿‡æœŸæ—¶é—´ï¼Ÿ
A: ä¿®æ”¹ `.env` ä¸­çš„ `ACCESS_TOKEN_EXPIRE_MINUTES`

Q: å¦‚ä½•æ‰©å±•æ•°æ®åº“å­—æ®µï¼Ÿ
A: ä¿®æ”¹ `app/models/` ä¸­çš„æ¨¡å‹ï¼Œç„¶åè¿è¡Œ `alembic revision --autogenerate`

## ğŸ‰ æ€»ç»“

âœ… **åŠŸèƒ½å®Œæ•´**ï¼šæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å·²å®ç°  
âœ… **ä»£ç è´¨é‡é«˜**ï¼šç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤  
âœ… **æ–‡æ¡£å®Œå–„**ï¼šæä¾›è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£  
âœ… **ç”Ÿäº§å°±ç»ª**ï¼šå¯ç›´æ¥ç”¨äºç”Ÿäº§ç¯å¢ƒ  
âœ… **æ˜“äºæ‰©å±•**ï¼šæ”¯æŒæ·»åŠ æ–°åŠŸèƒ½å’Œæ¨¡å‹

---

**é¡¹ç›®çŠ¶æ€**: âœ… å·²å®Œæˆï¼Œå¯ç›´æ¥ä½¿ç”¨  
**æŠ€æœ¯æ ˆ**: FastAPI + PostgreSQL + Redis + SQLAlchemy  
**æ”¯æŒçš„ AI å¹³å°**: OpenAI, é€šä¹‰åƒé—®, DeepSeek, ç¡…åŸºæµåŠ¨  
**å¼€å‘æ—¶é—´**: 2025-11-23  

ç«‹å³å¼€å§‹ä½¿ç”¨ï¼š`./start.sh` ğŸš€

