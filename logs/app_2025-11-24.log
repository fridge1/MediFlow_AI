2025-11-24 02:47:17.065 | INFO     | app.main:lifespan:38 - 应用启动中...
2025-11-24 02:47:17.065 | INFO     | app.main:lifespan:42 - 数据库连接已建立
2025-11-24 02:47:17.066 | INFO     | app.main:lifespan:46 - Redis 连接已建立
2025-11-24 02:47:17.066 | INFO     | app.main:lifespan:48 - Medical AI Platform v1.0.0 启动成功
2025-11-24 02:48:23.534 | ERROR    | app.middleware.error_handler:sqlalchemy_exception_handler:41 - 数据库错误: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedTableError'>: relation "users" does not exist
[SQL: SELECT users.id, users.email, users.username, users.hashed_password, users.full_name, users.is_active, users.is_superuser, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR]
[parameters: ('test_1763952503@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-24 02:48:23.549 | ERROR    | app.middleware.error_handler:sqlalchemy_exception_handler:41 - 数据库错误: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedTableError'>: relation "users" does not exist
[SQL: SELECT users.id, users.email, users.username, users.hashed_password, users.full_name, users.is_active, users.is_superuser, users.created_at, users.updated_at 
FROM users 
WHERE users.username = $1::VARCHAR]
[parameters: ('testuser_1763952503',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-24 02:48:58.608 | ERROR    | app.middleware.error_handler:sqlalchemy_exception_handler:41 - 数据库错误: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedTableError'>: relation "users" does not exist
[SQL: SELECT users.id, users.email, users.username, users.hashed_password, users.full_name, users.is_active, users.is_superuser, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR]
[parameters: ('test_1763952538@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-24 02:48:58.624 | ERROR    | app.middleware.error_handler:sqlalchemy_exception_handler:41 - 数据库错误: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedTableError'>: relation "users" does not exist
[SQL: SELECT users.id, users.email, users.username, users.hashed_password, users.full_name, users.is_active, users.is_superuser, users.created_at, users.updated_at 
FROM users 
WHERE users.username = $1::VARCHAR]
[parameters: ('testuser_1763952538',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-24 02:50:11.072 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffa34ad300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffa34ad3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffa388ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffa38bc410>
         │    └ <function Command.invoke at 0xffffa388c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffa38bc410>
           │   │      │    └ <function main at 0xffffa34bdc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffa3aab920>
           └ <click.core.Context object at 0xffffa38bc410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffa34bdc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffa3897240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffa3924720>
    └ <uvicorn.server.Server object at 0xffffa3a87590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffa39247c0>
           │       │   └ <uvicorn.server.Server object at 0xffffa3a87590>
           │       └ <function run at 0xffffa3d93d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffa34d09d0>
           │      └ <function Runner.run at 0xffffa3b6f9c0>
           └ <asyncio.runners.Runner object at 0xffffa350fb90>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffa34eda80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffa350fb90>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff9ec16950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff9c875a...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff9c8...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff9fc68350>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff9ec16950>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff9c875a...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff9c8...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff9c875a...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff9c8...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff9ec04610>
          └ <fastapi.applications.FastAPI object at 0xffff9fc68350>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff9c853880>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff9c8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff9ec07ed0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff9ec04610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff9c853380>
                     │    │             └ <starlette.requests.Request object at 0xffff9c8761d0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff9ec07ed0>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff9ec07ed0>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff9c8761d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff9c853380>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ ValueError('password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])')
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff9eb1ccc0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9eb1c540>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff9f84ae90>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff9ec07ed0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff9eb1ccc0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9eb1c540>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff9ebf5990>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff9f84ae90>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff9c853e20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9eb1c540>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff9ebf4790>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff9ebf5990>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff9c853e20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9eb1c540>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff9f01a290>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff9ebf4790>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff9c853e20>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9eb1c540>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffa2058900>
          └ APIRoute(path='/api/v1/auth/register', name='register', methods=['POST'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff9c853e20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9eb1c540>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff9ebcb920>
          └ APIRoute(path='/api/v1/auth/register', name='register', methods=['POST'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff9c876ad0>
                     └ <function get_request_handler.<locals>.app at 0xffff9ebcb9c0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xffffa2032ca0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.ext.asyncio.session.AsyncSession object at 0xffff9c877510>, 'user_data': UserCreate(email='test_1763952611...
                 │         └ <function register at 0xffff9fd758a0>
                 └ <fastapi.dependencies.models.Dependant object at 0xffff9ec33150>

  File "/app/app/api/v1/auth.py", line 31, in register
    user = await UserService.create_user(db, user_data)
                 │           │           │   └ UserCreate(email='test_1763952611@example.com', username='testuser_1763952611', full_name='Test User', password='Test123456')
                 │           │           └ <sqlalchemy.ext.asyncio.session.AsyncSession object at 0xffff9c877510>
                 │           └ <staticmethod(<function UserService.create_user at 0xffff9fd75620>)>
                 └ <class 'app.services.user_service.UserService'>

  File "/app/app/services/user_service.py", line 36, in create_user
    hashed_password=get_password_hash(user_data.password)
                    │                 │         └ 'Test123456'
                    │                 └ UserCreate(email='test_1763952611@example.com', username='testuser_1763952611', full_name='Test User', password='Test123456')
                    └ <function get_password_hash at 0xffff9fd74d60>

  File "/app/app/core/security.py", line 25, in get_password_hash
    return pwd_context.hash(password)
           │           │    └ 'Test123456'
           │           └ <function CryptContext.hash at 0xffff9fd58680>
           └ <CryptContext at 0xffffa0b5c5d0>

  File "/usr/local/lib/python3.11/site-packages/passlib/context.py", line 2258, in hash
    return record.hash(secret, **kwds)
           │      │    │         └ {}
           │      │    └ 'Test123456'
           │      └ <classmethod(<function GenericHandler.hash at 0xffff9ff52020>)>
           └ <class 'passlib.handlers.bcrypt.<customized bcrypt hasher>'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 779, in hash
    self.checksum = self._calc_checksum(secret)
    │    │          │    │              └ 'Test123456'
    │    │          │    └ <function _NoBackend._calc_checksum at 0xffff9fd5bba0>
    │    │          └ <passlib.handlers.bcrypt.<customized bcrypt hasher> object at 0xffff9f84bc10>
    │    └ None
    └ <passlib.handlers.bcrypt.<customized bcrypt hasher> object at 0xffff9f84bc10>
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 591, in _calc_checksum
    self._stub_requires_backend()
    │    └ <classmethod(<function BackendMixin._stub_requires_backend at 0xffff9fd30400>)>
    └ <passlib.handlers.bcrypt.<customized bcrypt hasher> object at 0xffff9f84bc10>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2254, in _stub_requires_backend
    cls.set_backend()
    │   └ <classmethod(<function BackendMixin.set_backend at 0xffff9fd30180>)>
    └ <class 'passlib.handlers.bcrypt.<customized bcrypt hasher>'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2156, in set_backend
    return owner.set_backend(name, dryrun=dryrun)
           │     │           │            └ False
           │     │           └ 'any'
           │     └ <classmethod(<function BackendMixin.set_backend at 0xffff9fd30180>)>
           └ <class 'passlib.handlers.bcrypt.bcrypt'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2163, in set_backend
    return cls.set_backend(name, dryrun=dryrun)
           │   │           │            └ False
           │   │           └ 'bcrypt'
           │   └ <classmethod(<function BackendMixin.set_backend at 0xffff9fd30180>)>
           └ <class 'passlib.handlers.bcrypt.bcrypt'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2188, in set_backend
    cls._set_backend(name, dryrun)
    │   │            │     └ False
    │   │            └ 'bcrypt'
    │   └ <classmethod(<function SubclassBackendMixin._set_backend at 0xffff9fd30540>)>
    └ <class 'passlib.handlers.bcrypt.bcrypt'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2311, in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
          │                     │                 │     └ False
          │                     │                 └ 'bcrypt'
          │                     └ <class 'passlib.handlers.bcrypt.bcrypt'>
          └ <class 'passlib.utils.handlers.SubclassBackendMixin'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2224, in _set_backend
    ok = loader(**kwds)
         │        └ {'name': 'bcrypt', 'dryrun': False}
         └ <bound method _BcryptBackend._load_backend_mixin of <class 'passlib.handlers.bcrypt._BcryptBackend'>>
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 626, in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
           │         │                       │     └ False
           │         │                       └ 'bcrypt'
           │         └ <classmethod(<function _BcryptCommon._finalize_backend_mixin at 0xffff9fd5b740>)>
           └ <class 'passlib.handlers.bcrypt._BcryptBackend'>
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 421, in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
       │               └ '$2a$'
       └ <function _BcryptCommon._finalize_backend_mixin.<locals>.detect_wrap_bug at 0xffff9c879b20>
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 380, in detect_wrap_bug
    if verify(secret, bug_hash):
       │      │       └ b'$2a$04$R1lJ2gkNaoPGdafE.H.16.nVyh2niHsGJhayOHLMiXlI45o8/DU.6'
       │      └ b'012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012...
       └ <bound method GenericHandler.verify of <class 'passlib.handlers.bcrypt._BcryptBackend'>>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 792, in verify
    return consteq(self._calc_checksum(secret), chk)
           │       │    │              │        └ 'nVyh2niHsGJhayOHLMiXlI45o8/DU.6'
           │       │    │              └ b'012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012...
           │       │    └ <function _BcryptBackend._calc_checksum at 0xffff9fd5bd80>
           │       └ <passlib.handlers.bcrypt._BcryptBackend object at 0xffff9ebfae90>
           └ <built-in function compare_digest>
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 655, in _calc_checksum
    hash = _bcrypt.hashpw(secret, config)
           │       │      │       └ b'$2a$04$R1lJ2gkNaoPGdafE.H.16.'
           │       │      └ b'012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012...
           │       └ <built-in function hashpw>
           └ <module 'bcrypt' from '/usr/local/lib/python3.11/site-packages/bcrypt/__init__.py'>

ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])
2025-11-24 02:50:11.103 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: 用户名或密码错误, 详情: None
2025-11-24 02:50:29.246 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffa34ad300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffa34ad3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffa388ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffa38bc410>
         │    └ <function Command.invoke at 0xffffa388c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffa38bc410>
           │   │      │    └ <function main at 0xffffa34bdc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffa3aab920>
           └ <click.core.Context object at 0xffffa38bc410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffa34bdc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffa3897240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffa3924720>
    └ <uvicorn.server.Server object at 0xffffa3a87590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffa39247c0>
           │       │   └ <uvicorn.server.Server object at 0xffffa3a87590>
           │       └ <function run at 0xffffa3d93d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffa34d09d0>
           │      └ <function Runner.run at 0xffffa3b6f9c0>
           └ <asyncio.runners.Runner object at 0xffffa350fb90>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffa34eda80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffa350fb90>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff9ec16950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff9c671b...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff9c6...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff9fc68350>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff9ec16950>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff9c671b...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff9c6...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff9c671b...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff9c6...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff9ec04610>
          └ <fastapi.applications.FastAPI object at 0xffff9fc68350>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff9c655440>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff9c6...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff9ec07ed0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff9ec04610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff9c655260>
                     │    │             └ <starlette.requests.Request object at 0xffff9c673210>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff9ec07ed0>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff9ec07ed0>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff9c673210>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff9c655260>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ ValueError('password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])')
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff9c655940>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9c6558a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff9f84ae90>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff9ec07ed0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff9c655940>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9c6558a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff9ebf5990>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff9f84ae90>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff9c654f40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9c6558a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff9ebf4790>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff9ebf5990>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff9c654f40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9c6558a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff9f01a290>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff9ebf4790>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff9c654f40>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9c6558a0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffa2058900>
          └ APIRoute(path='/api/v1/auth/register', name='register', methods=['POST'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff9c654f40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9c6558a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff9ebcb920>
          └ APIRoute(path='/api/v1/auth/register', name='register', methods=['POST'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff9c673850>
                     └ <function get_request_handler.<locals>.app at 0xffff9ebcb9c0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xffffa2032ca0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.ext.asyncio.session.AsyncSession object at 0xffff9c673f90>, 'user_data': UserCreate(email='test@example.co...
                 │         └ <function register at 0xffff9fd758a0>
                 └ <fastapi.dependencies.models.Dependant object at 0xffff9ec33150>

  File "/app/app/api/v1/auth.py", line 31, in register
    user = await UserService.create_user(db, user_data)
                 │           │           │   └ UserCreate(email='test@example.com', username='testuser', full_name='Test User', password='Test123456')
                 │           │           └ <sqlalchemy.ext.asyncio.session.AsyncSession object at 0xffff9c673f90>
                 │           └ <staticmethod(<function UserService.create_user at 0xffff9fd75620>)>
                 └ <class 'app.services.user_service.UserService'>

  File "/app/app/services/user_service.py", line 36, in create_user
    hashed_password=get_password_hash(user_data.password)
                    │                 │         └ 'Test123456'
                    │                 └ UserCreate(email='test@example.com', username='testuser', full_name='Test User', password='Test123456')
                    └ <function get_password_hash at 0xffff9fd74d60>

  File "/app/app/core/security.py", line 25, in get_password_hash
    return pwd_context.hash(password)
           │           │    └ 'Test123456'
           │           └ <function CryptContext.hash at 0xffff9fd58680>
           └ <CryptContext at 0xffffa0b5c5d0>

  File "/usr/local/lib/python3.11/site-packages/passlib/context.py", line 2258, in hash
    return record.hash(secret, **kwds)
           │      │    │         └ {}
           │      │    └ 'Test123456'
           │      └ <classmethod(<function GenericHandler.hash at 0xffff9ff52020>)>
           └ <class 'passlib.handlers.bcrypt.<customized bcrypt hasher>'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 779, in hash
    self.checksum = self._calc_checksum(secret)
    │    │          │    │              └ 'Test123456'
    │    │          │    └ <function _NoBackend._calc_checksum at 0xffff9fd5bba0>
    │    │          └ <passlib.handlers.bcrypt.<customized bcrypt hasher> object at 0xffff9c68cd10>
    │    └ None
    └ <passlib.handlers.bcrypt.<customized bcrypt hasher> object at 0xffff9c68cd10>
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 591, in _calc_checksum
    self._stub_requires_backend()
    │    └ <classmethod(<function BackendMixin._stub_requires_backend at 0xffff9fd30400>)>
    └ <passlib.handlers.bcrypt.<customized bcrypt hasher> object at 0xffff9c68cd10>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2254, in _stub_requires_backend
    cls.set_backend()
    │   └ <classmethod(<function BackendMixin.set_backend at 0xffff9fd30180>)>
    └ <class 'passlib.handlers.bcrypt.<customized bcrypt hasher>'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2156, in set_backend
    return owner.set_backend(name, dryrun=dryrun)
           │     │           │            └ False
           │     │           └ 'any'
           │     └ <classmethod(<function BackendMixin.set_backend at 0xffff9fd30180>)>
           └ <class 'passlib.handlers.bcrypt.bcrypt'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2163, in set_backend
    return cls.set_backend(name, dryrun=dryrun)
           │   │           │            └ False
           │   │           └ 'bcrypt'
           │   └ <classmethod(<function BackendMixin.set_backend at 0xffff9fd30180>)>
           └ <class 'passlib.handlers.bcrypt.bcrypt'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2188, in set_backend
    cls._set_backend(name, dryrun)
    │   │            │     └ False
    │   │            └ 'bcrypt'
    │   └ <classmethod(<function SubclassBackendMixin._set_backend at 0xffff9fd30540>)>
    └ <class 'passlib.handlers.bcrypt.bcrypt'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2311, in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
          │                     │                 │     └ False
          │                     │                 └ 'bcrypt'
          │                     └ <class 'passlib.handlers.bcrypt.bcrypt'>
          └ <class 'passlib.utils.handlers.SubclassBackendMixin'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2224, in _set_backend
    ok = loader(**kwds)
         │        └ {'name': 'bcrypt', 'dryrun': False}
         └ <bound method _BcryptBackend._load_backend_mixin of <class 'passlib.handlers.bcrypt._BcryptBackend'>>
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 626, in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
           │         │                       │     └ False
           │         │                       └ 'bcrypt'
           │         └ <classmethod(<function _BcryptCommon._finalize_backend_mixin at 0xffff9fd5b740>)>
           └ <class 'passlib.handlers.bcrypt._BcryptBackend'>
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 421, in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
       │               └ '$2a$'
       └ <function _BcryptCommon._finalize_backend_mixin.<locals>.detect_wrap_bug at 0xffff9c656c00>
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 380, in detect_wrap_bug
    if verify(secret, bug_hash):
       │      │       └ b'$2a$04$R1lJ2gkNaoPGdafE.H.16.nVyh2niHsGJhayOHLMiXlI45o8/DU.6'
       │      └ b'012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012...
       └ <bound method GenericHandler.verify of <class 'passlib.handlers.bcrypt._BcryptBackend'>>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 792, in verify
    return consteq(self._calc_checksum(secret), chk)
           │       │    │              │        └ 'nVyh2niHsGJhayOHLMiXlI45o8/DU.6'
           │       │    │              └ b'012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012...
           │       │    └ <function _BcryptBackend._calc_checksum at 0xffff9fd5bd80>
           │       └ <passlib.handlers.bcrypt._BcryptBackend object at 0xffff9ebdeb90>
           └ <built-in function compare_digest>
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 655, in _calc_checksum
    hash = _bcrypt.hashpw(secret, config)
           │       │      │       └ b'$2a$04$R1lJ2gkNaoPGdafE.H.16.'
           │       │      └ b'012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012...
           │       └ <built-in function hashpw>
           └ <module 'bcrypt' from '/usr/local/lib/python3.11/site-packages/bcrypt/__init__.py'>

ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])
2025-11-24 02:54:10.494 | INFO     | app.main:lifespan:53 - 应用关闭中...
2025-11-24 02:54:10.496 | INFO     | app.main:lifespan:57 - 数据库连接已关闭
2025-11-24 02:54:10.496 | INFO     | app.main:lifespan:61 - Redis 连接已关闭
2025-11-24 02:54:11.991 | INFO     | app.main:lifespan:38 - 应用启动中...
2025-11-24 02:54:11.991 | INFO     | app.main:lifespan:42 - 数据库连接已建立
2025-11-24 02:54:11.992 | INFO     | app.main:lifespan:46 - Redis 连接已建立
2025-11-24 02:54:11.992 | INFO     | app.main:lifespan:48 - Medical AI Platform v1.0.0 启动成功
2025-11-24 02:56:46.776 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb969d300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb969d3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb9a7ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb9aac410>
         │    └ <function Command.invoke at 0xffffb9a7c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb9aac410>
           │   │      │    └ <function main at 0xffffb96adc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb9c9b920>
           └ <click.core.Context object at 0xffffb9aac410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb96adc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb9a87240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb9b14720>
    └ <uvicorn.server.Server object at 0xffffb9c77590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb9b147c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb9c77590>
           │       └ <function run at 0xffffb9f83d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb96c49d0>
           │      └ <function Runner.run at 0xffffb9d5f9c0>
           └ <asyncio.runners.Runner object at 0xffffb96ffa90>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb96dda80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb96ffa90>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb5a42f50>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffb4ce6d...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffb4c...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb51c61d0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb5a42f50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffb4ce6d...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffb4c...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffb4ce6d...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffb4c...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffb4c8dc90>
          └ <fastapi.applications.FastAPI object at 0xffffb51c61d0>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffb4d0c540>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffb4c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffb4dfa210>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffb4c8dc90>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffb4d0cae0>
                     │    │             └ <starlette.requests.Request object at 0xffffb4ce7150>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffb4dfa210>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffb4dfa210>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffb4ce7150>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffb4d0cae0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ ValueError('password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])')
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffb4d0ccc0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffb4d0cb80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb5a3a690>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffb4dfa210>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffb4d0ccc0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffb4d0cb80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb4df97d0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb5a3a690>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffb4c89a80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffb4d0cb80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb5a46f10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb4df97d0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffb4c89a80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffb4d0cb80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb97250d0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb5a46f10>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffb4c89a80>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffb4d0cb80>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb8248900>
          └ APIRoute(path='/api/v1/auth/register', name='register', methods=['POST'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffb4c89a80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffb4d0cb80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffb4dca520>
          └ APIRoute(path='/api/v1/auth/register', name='register', methods=['POST'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffb4ce7bd0>
                     └ <function get_request_handler.<locals>.app at 0xffffb4dca340>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xffffb8226ca0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.ext.asyncio.session.AsyncSession object at 0xffffb4ed5650>, 'user_data': UserCreate(email='test_1763953006...
                 │         └ <function register at 0xffffb5f659e0>
                 └ <fastapi.dependencies.models.Dependant object at 0xffffb4e17590>

  File "/app/app/api/v1/auth.py", line 31, in register
    user = await UserService.create_user(db, user_data)
                 │           │           │   └ UserCreate(email='test_1763953006@example.com', username='testuser_1763953006', full_name='Test User', password='Test123456')
                 │           │           └ <sqlalchemy.ext.asyncio.session.AsyncSession object at 0xffffb4ed5650>
                 │           └ <staticmethod(<function UserService.create_user at 0xffffb5f65760>)>
                 └ <class 'app.services.user_service.UserService'>

  File "/app/app/services/user_service.py", line 36, in create_user
    hashed_password=get_password_hash(user_data.password)
                    │                 │         └ 'Test123456'
                    │                 └ UserCreate(email='test_1763953006@example.com', username='testuser_1763953006', full_name='Test User', password='Test123456')
                    └ <function get_password_hash at 0xffffb5f64ea0>

  File "/app/app/core/security.py", line 35, in get_password_hash
    return pwd_context.hash(password)
           │           │    └ 'Test123456'
           │           └ <function CryptContext.hash at 0xffffb5f487c0>
           └ <CryptContext at 0xffffb6d44210>

  File "/usr/local/lib/python3.11/site-packages/passlib/context.py", line 2258, in hash
    return record.hash(secret, **kwds)
           │      │    │         └ {}
           │      │    └ 'Test123456'
           │      └ <classmethod(<function GenericHandler.hash at 0xffffb6136160>)>
           └ <class 'passlib.handlers.bcrypt.<customized bcrypt hasher>'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 779, in hash
    self.checksum = self._calc_checksum(secret)
    │    │          │    │              └ 'Test123456'
    │    │          │    └ <function _NoBackend._calc_checksum at 0xffffb5f4bce0>
    │    │          └ <passlib.handlers.bcrypt.<customized bcrypt hasher> object at 0xffffb4df3490>
    │    └ None
    └ <passlib.handlers.bcrypt.<customized bcrypt hasher> object at 0xffffb4df3490>
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 591, in _calc_checksum
    self._stub_requires_backend()
    │    └ <classmethod(<function BackendMixin._stub_requires_backend at 0xffffb5f24540>)>
    └ <passlib.handlers.bcrypt.<customized bcrypt hasher> object at 0xffffb4df3490>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2254, in _stub_requires_backend
    cls.set_backend()
    │   └ <classmethod(<function BackendMixin.set_backend at 0xffffb5f242c0>)>
    └ <class 'passlib.handlers.bcrypt.<customized bcrypt hasher>'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2156, in set_backend
    return owner.set_backend(name, dryrun=dryrun)
           │     │           │            └ False
           │     │           └ 'any'
           │     └ <classmethod(<function BackendMixin.set_backend at 0xffffb5f242c0>)>
           └ <class 'passlib.handlers.bcrypt.bcrypt'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2163, in set_backend
    return cls.set_backend(name, dryrun=dryrun)
           │   │           │            └ False
           │   │           └ 'bcrypt'
           │   └ <classmethod(<function BackendMixin.set_backend at 0xffffb5f242c0>)>
           └ <class 'passlib.handlers.bcrypt.bcrypt'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2188, in set_backend
    cls._set_backend(name, dryrun)
    │   │            │     └ False
    │   │            └ 'bcrypt'
    │   └ <classmethod(<function SubclassBackendMixin._set_backend at 0xffffb5f24680>)>
    └ <class 'passlib.handlers.bcrypt.bcrypt'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2311, in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
          │                     │                 │     └ False
          │                     │                 └ 'bcrypt'
          │                     └ <class 'passlib.handlers.bcrypt.bcrypt'>
          └ <class 'passlib.utils.handlers.SubclassBackendMixin'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2224, in _set_backend
    ok = loader(**kwds)
         │        └ {'name': 'bcrypt', 'dryrun': False}
         └ <bound method _BcryptBackend._load_backend_mixin of <class 'passlib.handlers.bcrypt._BcryptBackend'>>
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 626, in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
           │         │                       │     └ False
           │         │                       └ 'bcrypt'
           │         └ <classmethod(<function _BcryptCommon._finalize_backend_mixin at 0xffffb5f4b880>)>
           └ <class 'passlib.handlers.bcrypt._BcryptBackend'>
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 421, in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
       │               └ '$2a$'
       └ <function _BcryptCommon._finalize_backend_mixin.<locals>.detect_wrap_bug at 0xffffb2a65080>
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 380, in detect_wrap_bug
    if verify(secret, bug_hash):
       │      │       └ b'$2a$04$R1lJ2gkNaoPGdafE.H.16.nVyh2niHsGJhayOHLMiXlI45o8/DU.6'
       │      └ b'012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012...
       └ <bound method GenericHandler.verify of <class 'passlib.handlers.bcrypt._BcryptBackend'>>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 792, in verify
    return consteq(self._calc_checksum(secret), chk)
           │       │    │              │        └ 'nVyh2niHsGJhayOHLMiXlI45o8/DU.6'
           │       │    │              └ b'012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012...
           │       │    └ <function _BcryptBackend._calc_checksum at 0xffffb5f4bec0>
           │       └ <passlib.handlers.bcrypt._BcryptBackend object at 0xffffb4cd1a10>
           └ <built-in function compare_digest>
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 655, in _calc_checksum
    hash = _bcrypt.hashpw(secret, config)
           │       │      │       └ b'$2a$04$R1lJ2gkNaoPGdafE.H.16.'
           │       │      └ b'012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012...
           │       └ <built-in function hashpw>
           └ <module 'bcrypt' from '/usr/local/lib/python3.11/site-packages/bcrypt/__init__.py'>

ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])
2025-11-24 02:56:46.802 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: 用户名或密码错误, 详情: None
2025-11-24 02:57:02.967 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb969d300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb969d3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb9a7ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb9aac410>
         │    └ <function Command.invoke at 0xffffb9a7c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb9aac410>
           │   │      │    └ <function main at 0xffffb96adc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb9c9b920>
           └ <click.core.Context object at 0xffffb9aac410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb96adc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb9a87240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb9b14720>
    └ <uvicorn.server.Server object at 0xffffb9c77590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb9b147c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb9c77590>
           │       └ <function run at 0xffffb9f83d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb96c49d0>
           │      └ <function Runner.run at 0xffffb9d5f9c0>
           └ <asyncio.runners.Runner object at 0xffffb96ffa90>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb96dda80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb96ffa90>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb5a42f50>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffb28701...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffb28...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb51c61d0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb5a42f50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffb28701...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffb28...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffb28701...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffb28...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffb4c8dc90>
          └ <fastapi.applications.FastAPI object at 0xffffb51c61d0>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffb2858860>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffb28...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffb4dfa210>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffb4c8dc90>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffb2858720>
                     │    │             └ <starlette.requests.Request object at 0xffffb2870390>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffb4dfa210>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffb4dfa210>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffb2870390>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffb2858720>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ ValueError('password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])')
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffb2858d60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffb28585e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb5a3a690>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffb4dfa210>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffb2858d60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffb28585e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb4df97d0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb5a3a690>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffb2858e00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffb28585e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb5a46f10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb4df97d0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffb2858e00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffb28585e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb97250d0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb5a46f10>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffb2858e00>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffb28585e0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb8248900>
          └ APIRoute(path='/api/v1/auth/register', name='register', methods=['POST'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffb2858e00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffb28585e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffb4dca520>
          └ APIRoute(path='/api/v1/auth/register', name='register', methods=['POST'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffb2870610>
                     └ <function get_request_handler.<locals>.app at 0xffffb4dca340>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xffffb8226ca0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.ext.asyncio.session.AsyncSession object at 0xffffb2870e10>, 'user_data': UserCreate(email='manualtest@exam...
                 │         └ <function register at 0xffffb5f659e0>
                 └ <fastapi.dependencies.models.Dependant object at 0xffffb4e17590>

  File "/app/app/api/v1/auth.py", line 31, in register
    user = await UserService.create_user(db, user_data)
                 │           │           │   └ UserCreate(email='manualtest@example.com', username='manualtest', full_name='Manual Test', password='Test123456')
                 │           │           └ <sqlalchemy.ext.asyncio.session.AsyncSession object at 0xffffb2870e10>
                 │           └ <staticmethod(<function UserService.create_user at 0xffffb5f65760>)>
                 └ <class 'app.services.user_service.UserService'>

  File "/app/app/services/user_service.py", line 36, in create_user
    hashed_password=get_password_hash(user_data.password)
                    │                 │         └ 'Test123456'
                    │                 └ UserCreate(email='manualtest@example.com', username='manualtest', full_name='Manual Test', password='Test123456')
                    └ <function get_password_hash at 0xffffb5f64ea0>

  File "/app/app/core/security.py", line 35, in get_password_hash
    return pwd_context.hash(password)
           │           │    └ 'Test123456'
           │           └ <function CryptContext.hash at 0xffffb5f487c0>
           └ <CryptContext at 0xffffb6d44210>

  File "/usr/local/lib/python3.11/site-packages/passlib/context.py", line 2258, in hash
    return record.hash(secret, **kwds)
           │      │    │         └ {}
           │      │    └ 'Test123456'
           │      └ <classmethod(<function GenericHandler.hash at 0xffffb6136160>)>
           └ <class 'passlib.handlers.bcrypt.<customized bcrypt hasher>'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 779, in hash
    self.checksum = self._calc_checksum(secret)
    │    │          │    │              └ 'Test123456'
    │    │          │    └ <function _NoBackend._calc_checksum at 0xffffb5f4bce0>
    │    │          └ <passlib.handlers.bcrypt.<customized bcrypt hasher> object at 0xffffb2871b90>
    │    └ None
    └ <passlib.handlers.bcrypt.<customized bcrypt hasher> object at 0xffffb2871b90>
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 591, in _calc_checksum
    self._stub_requires_backend()
    │    └ <classmethod(<function BackendMixin._stub_requires_backend at 0xffffb5f24540>)>
    └ <passlib.handlers.bcrypt.<customized bcrypt hasher> object at 0xffffb2871b90>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2254, in _stub_requires_backend
    cls.set_backend()
    │   └ <classmethod(<function BackendMixin.set_backend at 0xffffb5f242c0>)>
    └ <class 'passlib.handlers.bcrypt.<customized bcrypt hasher>'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2156, in set_backend
    return owner.set_backend(name, dryrun=dryrun)
           │     │           │            └ False
           │     │           └ 'any'
           │     └ <classmethod(<function BackendMixin.set_backend at 0xffffb5f242c0>)>
           └ <class 'passlib.handlers.bcrypt.bcrypt'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2163, in set_backend
    return cls.set_backend(name, dryrun=dryrun)
           │   │           │            └ False
           │   │           └ 'bcrypt'
           │   └ <classmethod(<function BackendMixin.set_backend at 0xffffb5f242c0>)>
           └ <class 'passlib.handlers.bcrypt.bcrypt'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2188, in set_backend
    cls._set_backend(name, dryrun)
    │   │            │     └ False
    │   │            └ 'bcrypt'
    │   └ <classmethod(<function SubclassBackendMixin._set_backend at 0xffffb5f24680>)>
    └ <class 'passlib.handlers.bcrypt.bcrypt'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2311, in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
          │                     │                 │     └ False
          │                     │                 └ 'bcrypt'
          │                     └ <class 'passlib.handlers.bcrypt.bcrypt'>
          └ <class 'passlib.utils.handlers.SubclassBackendMixin'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2224, in _set_backend
    ok = loader(**kwds)
         │        └ {'name': 'bcrypt', 'dryrun': False}
         └ <bound method _BcryptBackend._load_backend_mixin of <class 'passlib.handlers.bcrypt._BcryptBackend'>>
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 626, in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
           │         │                       │     └ False
           │         │                       └ 'bcrypt'
           │         └ <classmethod(<function _BcryptCommon._finalize_backend_mixin at 0xffffb5f4b880>)>
           └ <class 'passlib.handlers.bcrypt._BcryptBackend'>
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 421, in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
       │               └ '$2a$'
       └ <function _BcryptCommon._finalize_backend_mixin.<locals>.detect_wrap_bug at 0xffffb2859940>
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 380, in detect_wrap_bug
    if verify(secret, bug_hash):
       │      │       └ b'$2a$04$R1lJ2gkNaoPGdafE.H.16.nVyh2niHsGJhayOHLMiXlI45o8/DU.6'
       │      └ b'012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012...
       └ <bound method GenericHandler.verify of <class 'passlib.handlers.bcrypt._BcryptBackend'>>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 792, in verify
    return consteq(self._calc_checksum(secret), chk)
           │       │    │              │        └ 'nVyh2niHsGJhayOHLMiXlI45o8/DU.6'
           │       │    │              └ b'012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012...
           │       │    └ <function _BcryptBackend._calc_checksum at 0xffffb5f4bec0>
           │       └ <passlib.handlers.bcrypt._BcryptBackend object at 0xffffb2871690>
           └ <built-in function compare_digest>
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 655, in _calc_checksum
    hash = _bcrypt.hashpw(secret, config)
           │       │      │       └ b'$2a$04$R1lJ2gkNaoPGdafE.H.16.'
           │       │      └ b'012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012...
           │       └ <built-in function hashpw>
           └ <module 'bcrypt' from '/usr/local/lib/python3.11/site-packages/bcrypt/__init__.py'>

ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])
2025-11-24 02:57:33.513 | INFO     | app.main:lifespan:53 - 应用关闭中...
2025-11-24 02:57:33.515 | INFO     | app.main:lifespan:57 - 数据库连接已关闭
2025-11-24 02:57:33.515 | INFO     | app.main:lifespan:61 - Redis 连接已关闭
2025-11-24 02:57:34.989 | INFO     | app.main:lifespan:38 - 应用启动中...
2025-11-24 02:57:34.989 | INFO     | app.main:lifespan:42 - 数据库连接已建立
2025-11-24 02:57:34.990 | INFO     | app.main:lifespan:46 - Redis 连接已建立
2025-11-24 02:57:34.990 | INFO     | app.main:lifespan:48 - Medical AI Platform v1.0.0 启动成功
2025-11-24 02:58:25.771 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff928bd300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff928bd3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff92c9ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff92ccc410>
         │    └ <function Command.invoke at 0xffff92c9c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff92ccc410>
           │   │      │    └ <function main at 0xffff928cdc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff92ebb920>
           └ <click.core.Context object at 0xffff92ccc410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff928cdc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff92ca7240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff92d34720>
    └ <uvicorn.server.Server object at 0xffff92e97590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff92d347c0>
           │       │   └ <uvicorn.server.Server object at 0xffff92e97590>
           │       └ <function run at 0xffff931a3d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff928e49d0>
           │      └ <function Runner.run at 0xffff92f7f9c0>
           └ <asyncio.runners.Runner object at 0xffff9291fa90>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff928fda80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff9291fa90>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8de81050>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff8dfd5e...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff8df...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff8e0161d0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8de81050>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff8dfd5e...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff8df...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff8dfd5e...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff8df...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8e16cc10>
          └ <fastapi.applications.FastAPI object at 0xffff8e0161d0>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff8dea9bc0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff8df...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff8e033090>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8e16cc10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff8dea9c60>
                     │    │             └ <starlette.requests.Request object at 0xffff8dff4dd0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff8e033090>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff8e033090>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff8dff4dd0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff8dea9c60>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ ValueError('password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])')
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff8df2c4a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8e035260>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff8ec61bd0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff8e033090>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff8df2c4a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8e035260>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff8ec61f50>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff8ec61bd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff928cd080>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8e035260>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff8ec66cd0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff8ec61f50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff928cd080>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8e035260>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff8f0c4e50>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff8ec66cd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff928cd080>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8e035260>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff91468900>
          └ APIRoute(path='/api/v1/auth/register', name='register', methods=['POST'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff928cd080>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8e035260>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff8dfe1080>
          └ APIRoute(path='/api/v1/auth/register', name='register', methods=['POST'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff8dff42d0>
                     └ <function get_request_handler.<locals>.app at 0xffff8dfe39c0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xffff91442ca0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.ext.asyncio.session.AsyncSession object at 0xffff8e41ff90>, 'user_data': UserCreate(email='finaltest@examp...
                 │         └ <function register at 0xffff8f185a80>
                 └ <fastapi.dependencies.models.Dependant object at 0xffff8e033010>

  File "/app/app/api/v1/auth.py", line 31, in register
    user = await UserService.create_user(db, user_data)
                 │           │           │   └ UserCreate(email='finaltest@example.com', username='finaltest', full_name='Final Test', password='Test123456')
                 │           │           └ <sqlalchemy.ext.asyncio.session.AsyncSession object at 0xffff8e41ff90>
                 │           └ <staticmethod(<function UserService.create_user at 0xffff8f185800>)>
                 └ <class 'app.services.user_service.UserService'>

  File "/app/app/services/user_service.py", line 36, in create_user
    hashed_password=get_password_hash(user_data.password)
                    │                 │         └ 'Test123456'
                    │                 └ UserCreate(email='finaltest@example.com', username='finaltest', full_name='Final Test', password='Test123456')
                    └ <function get_password_hash at 0xffff8f184f40>

  File "/app/app/core/security.py", line 40, in get_password_hash
    return pwd_context.hash(password)
           │           │    └ 'Test123456'
           │           └ <function CryptContext.hash at 0xffff8f1687c0>
           └ <CryptContext at 0xffff8ff64510>

  File "/usr/local/lib/python3.11/site-packages/passlib/context.py", line 2258, in hash
    return record.hash(secret, **kwds)
           │      │    │         └ {}
           │      │    └ 'Test123456'
           │      └ <classmethod(<function GenericHandler.hash at 0xffff8f356160>)>
           └ <class 'passlib.handlers.bcrypt.<customized bcrypt hasher>'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 779, in hash
    self.checksum = self._calc_checksum(secret)
    │    │          │    │              └ 'Test123456'
    │    │          │    └ <function _NoBackend._calc_checksum at 0xffff8f16bce0>
    │    │          └ <passlib.handlers.bcrypt.<customized bcrypt hasher> object at 0xffff8e00f750>
    │    └ None
    └ <passlib.handlers.bcrypt.<customized bcrypt hasher> object at 0xffff8e00f750>
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 591, in _calc_checksum
    self._stub_requires_backend()
    │    └ <classmethod(<function BackendMixin._stub_requires_backend at 0xffff8f144540>)>
    └ <passlib.handlers.bcrypt.<customized bcrypt hasher> object at 0xffff8e00f750>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2254, in _stub_requires_backend
    cls.set_backend()
    │   └ <classmethod(<function BackendMixin.set_backend at 0xffff8f1442c0>)>
    └ <class 'passlib.handlers.bcrypt.<customized bcrypt hasher>'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2156, in set_backend
    return owner.set_backend(name, dryrun=dryrun)
           │     │           │            └ False
           │     │           └ 'any'
           │     └ <classmethod(<function BackendMixin.set_backend at 0xffff8f1442c0>)>
           └ <class 'passlib.handlers.bcrypt.bcrypt'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2163, in set_backend
    return cls.set_backend(name, dryrun=dryrun)
           │   │           │            └ False
           │   │           └ 'bcrypt'
           │   └ <classmethod(<function BackendMixin.set_backend at 0xffff8f1442c0>)>
           └ <class 'passlib.handlers.bcrypt.bcrypt'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2188, in set_backend
    cls._set_backend(name, dryrun)
    │   │            │     └ False
    │   │            └ 'bcrypt'
    │   └ <classmethod(<function SubclassBackendMixin._set_backend at 0xffff8f144680>)>
    └ <class 'passlib.handlers.bcrypt.bcrypt'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2311, in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
          │                     │                 │     └ False
          │                     │                 └ 'bcrypt'
          │                     └ <class 'passlib.handlers.bcrypt.bcrypt'>
          └ <class 'passlib.utils.handlers.SubclassBackendMixin'>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 2224, in _set_backend
    ok = loader(**kwds)
         │        └ {'name': 'bcrypt', 'dryrun': False}
         └ <bound method _BcryptBackend._load_backend_mixin of <class 'passlib.handlers.bcrypt._BcryptBackend'>>
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 626, in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
           │         │                       │     └ False
           │         │                       └ 'bcrypt'
           │         └ <classmethod(<function _BcryptCommon._finalize_backend_mixin at 0xffff8f16b880>)>
           └ <class 'passlib.handlers.bcrypt._BcryptBackend'>
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 421, in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
       │               └ '$2a$'
       └ <function _BcryptCommon._finalize_backend_mixin.<locals>.detect_wrap_bug at 0xffff8bc81120>
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 380, in detect_wrap_bug
    if verify(secret, bug_hash):
       │      │       └ b'$2a$04$R1lJ2gkNaoPGdafE.H.16.nVyh2niHsGJhayOHLMiXlI45o8/DU.6'
       │      └ b'012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012...
       └ <bound method GenericHandler.verify of <class 'passlib.handlers.bcrypt._BcryptBackend'>>
  File "/usr/local/lib/python3.11/site-packages/passlib/utils/handlers.py", line 792, in verify
    return consteq(self._calc_checksum(secret), chk)
           │       │    │              │        └ 'nVyh2niHsGJhayOHLMiXlI45o8/DU.6'
           │       │    │              └ b'012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012...
           │       │    └ <function _BcryptBackend._calc_checksum at 0xffff8f16bec0>
           │       └ <passlib.handlers.bcrypt._BcryptBackend object at 0xffff8e0395d0>
           └ <built-in function compare_digest>
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 655, in _calc_checksum
    hash = _bcrypt.hashpw(secret, config)
           │       │      │       └ b'$2a$04$R1lJ2gkNaoPGdafE.H.16.'
           │       │      └ b'012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012...
           │       └ <built-in function hashpw>
           └ <module 'bcrypt' from '/usr/local/lib/python3.11/site-packages/bcrypt/__init__.py'>

ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])
2025-11-24 02:59:46.738 | INFO     | app.main:lifespan:53 - 应用关闭中...
2025-11-24 02:59:46.740 | INFO     | app.main:lifespan:57 - 数据库连接已关闭
2025-11-24 02:59:46.740 | INFO     | app.main:lifespan:61 - Redis 连接已关闭
2025-11-24 02:59:48.165 | INFO     | app.main:lifespan:38 - 应用启动中...
2025-11-24 02:59:48.165 | INFO     | app.main:lifespan:42 - 数据库连接已建立
2025-11-24 02:59:48.165 | INFO     | app.main:lifespan:46 - Redis 连接已建立
2025-11-24 02:59:48.165 | INFO     | app.main:lifespan:48 - Medical AI Platform v1.0.0 启动成功
2025-11-24 03:00:41.561 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.application.Application'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff8d6ad300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff8d6ad3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff8da8ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff8dabc410>
         │    └ <function Command.invoke at 0xffff8da8c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff8dabc410>
           │   │      │    └ <function main at 0xffff8d6bdc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8dcab920>
           └ <click.core.Context object at 0xffff8dabc410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff8d6bdc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff8da97240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff8db24720>
    └ <uvicorn.server.Server object at 0xffff8dc87590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff8db247c0>
           │       │   └ <uvicorn.server.Server object at 0xffff8dc87590>
           │       └ <function run at 0xffff8df93d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff8d6d49d0>
           │      └ <function Runner.run at 0xffff8dd6f9c0>
           └ <asyncio.runners.Runner object at 0xffff8d70fa90>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff8d6eda80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff8d70fa90>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8d728150>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86c5d2...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86c...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff896b6190>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8d728150>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86c5d2...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86c...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86c5d2...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86c...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff88e34210>
          └ <fastapi.applications.FastAPI object at 0xffff896b6190>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff86bfbec0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff88e34210>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff86c26340>
                     │    │             └ <starlette.requests.Request object at 0xffff86c5c650>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff86c5c650>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff86c26340>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.application.Application'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff86c26520>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86c240e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff88dda710>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff86c26520>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86c240e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff88fb1f50>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff88dda710>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86c26660>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86c240e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff88fb1950>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff88fb1f50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86c26660>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86c240e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff88f72cd0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff88fb1950>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86c26660>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86c240e0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff8c258900>
          └ APIRoute(path='/api/v1/applications', name='list_applications', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86c26660>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86c240e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff88de0f40>
          └ APIRoute(path='/api/v1/applications', name='list_applications', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff86c23790>
                     └ <function get_request_handler.<locals>.app at 0xffff88de00e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff8c6b3240>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff8c5c5a80>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_applications_api_v1_applica...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff8c5c54e0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff88e21910>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_applications_api_v1_applica...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaae9131480,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff88e21910>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.application.Application'>
2025-11-24 03:00:41.609 | INFO     | app.services.conversation_service:create_conversation:39 - 创建会话: c0ea81e0-e889-4e87-bf32-402f816063f4, 用户: a1079794-367a-466c-a0a5-39b1879ada3a
2025-11-24 03:00:41.630 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff8d6ad300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff8d6ad3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff8da8ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff8dabc410>
         │    └ <function Command.invoke at 0xffff8da8c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff8dabc410>
           │   │      │    └ <function main at 0xffff8d6bdc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8dcab920>
           └ <click.core.Context object at 0xffff8dabc410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff8d6bdc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff8da97240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff8db24720>
    └ <uvicorn.server.Server object at 0xffff8dc87590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff8db247c0>
           │       │   └ <uvicorn.server.Server object at 0xffff8dc87590>
           │       └ <function run at 0xffff8df93d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff8d6d49d0>
           │      └ <function Runner.run at 0xffff8dd6f9c0>
           └ <asyncio.runners.Runner object at 0xffff8d70fa90>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff8d6eda80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff8d70fa90>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8d728150>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a10a...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff896b6190>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8d728150>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a10a...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a10a...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff88e34210>
          └ <fastapi.applications.FastAPI object at 0xffff896b6190>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff86c247c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff88e34210>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff8699f560>
                     │    │             └ <starlette.requests.Request object at 0xffff86a13a50>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff86a13a50>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff8699f560>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff8699e0c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8699e160>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff88dda710>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff8699e0c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8699e160>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff88fb1f50>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff88dda710>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff8699f420>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8699e160>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff88fb1950>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff88fb1f50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff8699f420>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8699e160>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff88f72cd0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff88fb1950>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff8699f420>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8699e160>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff8c258900>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff8699f420>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8699e160>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff88de37e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff86a23d10>
                     └ <function get_request_handler.<locals>.app at 0xffff88de36a0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff8c6b3240>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff8c5c5a80>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff8c5c54e0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff88e3e490>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaae9131480,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff88e3e490>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:00:41.675 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff8d6ad300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff8d6ad3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff8da8ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff8dabc410>
         │    └ <function Command.invoke at 0xffff8da8c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff8dabc410>
           │   │      │    └ <function main at 0xffff8d6bdc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8dcab920>
           └ <click.core.Context object at 0xffff8dabc410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff8d6bdc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff8da97240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff8db24720>
    └ <uvicorn.server.Server object at 0xffff8dc87590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff8db247c0>
           │       │   └ <uvicorn.server.Server object at 0xffff8dc87590>
           │       └ <function run at 0xffff8df93d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff8d6d49d0>
           │      └ <function Runner.run at 0xffff8dd6f9c0>
           └ <asyncio.runners.Runner object at 0xffff8d70fa90>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff8d6eda80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff8d70fa90>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8d728150>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a461...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff896b6190>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8d728150>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a461...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a461...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff88e34210>
          └ <fastapi.applications.FastAPI object at 0xffff896b6190>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff8699fe20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff88e34210>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff8699f920>
                     │    │             └ <starlette.requests.Request object at 0xffff86a460d0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff86a460d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff8699f920>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff8699f4c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8699f1a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff88dda710>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff8699f4c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8699f1a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff88fb1f50>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff88dda710>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff8699fec0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8699f1a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff88fb1950>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff88fb1f50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff8699fec0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8699f1a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff88f72cd0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff88fb1950>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff8699fec0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8699f1a0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff8c258900>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff8699fec0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8699f1a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff88de37e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff86a508d0>
                     └ <function get_request_handler.<locals>.app at 0xffff88de36a0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff8c6b3240>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff8c5c5a80>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff8c5c54e0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff88e3e490>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaae9131480,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff88e3e490>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:00:41.699 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff8d6ad300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff8d6ad3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff8da8ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff8dabc410>
         │    └ <function Command.invoke at 0xffff8da8c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff8dabc410>
           │   │      │    └ <function main at 0xffff8d6bdc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8dcab920>
           └ <click.core.Context object at 0xffff8dabc410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff8d6bdc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff8da97240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff8db24720>
    └ <uvicorn.server.Server object at 0xffff8dc87590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff8db247c0>
           │       │   └ <uvicorn.server.Server object at 0xffff8dc87590>
           │       └ <function run at 0xffff8df93d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff8d6d49d0>
           │      └ <function Runner.run at 0xffff8dd6f9c0>
           └ <asyncio.runners.Runner object at 0xffff8d70fa90>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff8d6eda80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff8d70fa90>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8d728150>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a527...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff896b6190>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8d728150>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a527...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a527...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff88e34210>
          └ <fastapi.applications.FastAPI object at 0xffff896b6190>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff86a25440>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff88e34210>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff86a258a0>
                     │    │             └ <starlette.requests.Request object at 0xffff86a51d50>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff86a51d50>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff86a258a0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff86a25940>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a25580>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff88dda710>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff86a25940>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a25580>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff88fb1f50>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff88dda710>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a259e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a25580>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff88fb1950>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff88fb1f50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a259e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a25580>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff88f72cd0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff88fb1950>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a259e0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a25580>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff8c258900>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a259e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a25580>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff88de37e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff86a52210>
                     └ <function get_request_handler.<locals>.app at 0xffff88de36a0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff8c6b3240>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff8c5c5a80>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff8c5c54e0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff88e3e490>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaae9131480,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff88e3e490>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:00:41.721 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff8d6ad300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff8d6ad3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff8da8ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff8dabc410>
         │    └ <function Command.invoke at 0xffff8da8c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff8dabc410>
           │   │      │    └ <function main at 0xffff8d6bdc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8dcab920>
           └ <click.core.Context object at 0xffff8dabc410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff8d6bdc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff8da97240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff8db24720>
    └ <uvicorn.server.Server object at 0xffff8dc87590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff8db247c0>
           │       │   └ <uvicorn.server.Server object at 0xffff8dc87590>
           │       └ <function run at 0xffff8df93d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff8d6d49d0>
           │      └ <function Runner.run at 0xffff8dd6f9c0>
           └ <asyncio.runners.Runner object at 0xffff8d70fa90>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff8d6eda80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff8d70fa90>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8d728150>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a650...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff896b6190>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8d728150>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a650...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a650...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff88e34210>
          └ <fastapi.applications.FastAPI object at 0xffff896b6190>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff86a26980>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff88e34210>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff86a267a0>
                     │    │             └ <starlette.requests.Request object at 0xffff86a64150>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff86a64150>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff86a267a0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff86a25b20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a25bc0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff88dda710>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff86a25b20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a25bc0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff88fb1f50>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff88dda710>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff8699e840>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a25bc0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff88fb1950>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff88fb1f50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff8699e840>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a25bc0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff88f72cd0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff88fb1950>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff8699e840>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a25bc0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff8c258900>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff8699e840>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a25bc0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff88de37e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff86a64810>
                     └ <function get_request_handler.<locals>.app at 0xffff88de36a0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff8c6b3240>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff8c5c5a80>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff8c5c54e0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff88e3e490>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaae9131480,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff88e3e490>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:00:41.743 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff8d6ad300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff8d6ad3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff8da8ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff8dabc410>
         │    └ <function Command.invoke at 0xffff8da8c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff8dabc410>
           │   │      │    └ <function main at 0xffff8d6bdc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8dcab920>
           └ <click.core.Context object at 0xffff8dabc410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff8d6bdc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff8da97240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff8db24720>
    └ <uvicorn.server.Server object at 0xffff8dc87590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff8db247c0>
           │       │   └ <uvicorn.server.Server object at 0xffff8dc87590>
           │       └ <function run at 0xffff8df93d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff8d6d49d0>
           │      └ <function Runner.run at 0xffff8dd6f9c0>
           └ <asyncio.runners.Runner object at 0xffff8d70fa90>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff8d6eda80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff8d70fa90>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8d728150>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a518...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff896b6190>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8d728150>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a518...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a518...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff88e34210>
          └ <fastapi.applications.FastAPI object at 0xffff896b6190>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff8699f920>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff88e34210>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff8699fec0>
                     │    │             └ <starlette.requests.Request object at 0xffff86a51490>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff86a51490>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff8699fec0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff8699f1a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8699de40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff88dda710>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff8699f1a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8699de40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff88fb1f50>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff88dda710>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a27240>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8699de40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff88fb1950>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff88fb1f50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a27240>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8699de40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff88f72cd0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff88fb1950>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a27240>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8699de40>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff8c258900>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a27240>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8699de40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff88de37e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff86a51bd0>
                     └ <function get_request_handler.<locals>.app at 0xffff88de36a0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff8c6b3240>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff8c5c5a80>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff8c5c54e0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff88e3e490>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaae9131480,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff88e3e490>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:00:41.764 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff8d6ad300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff8d6ad3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff8da8ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff8dabc410>
         │    └ <function Command.invoke at 0xffff8da8c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff8dabc410>
           │   │      │    └ <function main at 0xffff8d6bdc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8dcab920>
           └ <click.core.Context object at 0xffff8dabc410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff8d6bdc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff8da97240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff8db24720>
    └ <uvicorn.server.Server object at 0xffff8dc87590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff8db247c0>
           │       │   └ <uvicorn.server.Server object at 0xffff8dc87590>
           │       └ <function run at 0xffff8df93d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff8d6d49d0>
           │      └ <function Runner.run at 0xffff8dd6f9c0>
           └ <asyncio.runners.Runner object at 0xffff8d70fa90>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff8d6eda80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff8d70fa90>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8d728150>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a456...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff896b6190>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8d728150>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a456...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a456...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff88e34210>
          └ <fastapi.applications.FastAPI object at 0xffff896b6190>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff8699f380>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff88e34210>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff86a259e0>
                     │    │             └ <starlette.requests.Request object at 0xffff86a46150>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff86a46150>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff86a259e0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff86a26ac0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a271a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff88dda710>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff86a26ac0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a271a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff88fb1f50>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff88dda710>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a25440>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a271a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff88fb1950>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff88fb1f50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a25440>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a271a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff88f72cd0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff88fb1950>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a25440>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a271a0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff8c258900>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a25440>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a271a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff88de37e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff86a65910>
                     └ <function get_request_handler.<locals>.app at 0xffff88de36a0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff8c6b3240>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff8c5c5a80>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff8c5c54e0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff88e3e490>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaae9131480,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff88e3e490>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:00:41.784 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff8d6ad300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff8d6ad3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff8da8ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff8dabc410>
         │    └ <function Command.invoke at 0xffff8da8c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff8dabc410>
           │   │      │    └ <function main at 0xffff8d6bdc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8dcab920>
           └ <click.core.Context object at 0xffff8dabc410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff8d6bdc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff8da97240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff8db24720>
    └ <uvicorn.server.Server object at 0xffff8dc87590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff8db247c0>
           │       │   └ <uvicorn.server.Server object at 0xffff8dc87590>
           │       └ <function run at 0xffff8df93d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff8d6d49d0>
           │      └ <function Runner.run at 0xffff8dd6f9c0>
           └ <asyncio.runners.Runner object at 0xffff8d70fa90>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff8d6eda80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff8d70fa90>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8d728150>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a67e...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff896b6190>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8d728150>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a67e...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a67e...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff88e34210>
          └ <fastapi.applications.FastAPI object at 0xffff896b6190>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff86a27380>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff88e34210>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff86a268e0>
                     │    │             └ <starlette.requests.Request object at 0xffff86a67010>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff86a67010>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff86a268e0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff86a262a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a249a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff88dda710>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff86a262a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a249a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff88fb1f50>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff88dda710>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a25580>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a249a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff88fb1950>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff88fb1f50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a25580>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a249a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff88f72cd0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff88fb1950>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a25580>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a249a0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff8c258900>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a25580>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a249a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff88de37e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff86a67590>
                     └ <function get_request_handler.<locals>.app at 0xffff88de36a0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff8c6b3240>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff8c5c5a80>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff8c5c54e0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff88e3e490>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaae9131480,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff88e3e490>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:00:41.804 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff8d6ad300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff8d6ad3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff8da8ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff8dabc410>
         │    └ <function Command.invoke at 0xffff8da8c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff8dabc410>
           │   │      │    └ <function main at 0xffff8d6bdc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8dcab920>
           └ <click.core.Context object at 0xffff8dabc410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff8d6bdc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff8da97240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff8db24720>
    └ <uvicorn.server.Server object at 0xffff8dc87590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff8db247c0>
           │       │   └ <uvicorn.server.Server object at 0xffff8dc87590>
           │       └ <function run at 0xffff8df93d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff8d6d49d0>
           │      └ <function Runner.run at 0xffff8dd6f9c0>
           └ <asyncio.runners.Runner object at 0xffff8d70fa90>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff8d6eda80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff8d70fa90>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8d728150>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a667...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff896b6190>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8d728150>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a667...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a667...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff88e34210>
          └ <fastapi.applications.FastAPI object at 0xffff896b6190>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff8699f380>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff88e34210>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff8699fec0>
                     │    │             └ <starlette.requests.Request object at 0xffff86a64390>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff86a64390>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff8699fec0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff86a27d80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8699f1a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff88dda710>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff86a27d80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8699f1a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff88fb1f50>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff88dda710>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a27740>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8699f1a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff88fb1950>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff88fb1f50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a27740>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8699f1a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff88f72cd0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff88fb1950>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a27740>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8699f1a0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff8c258900>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a27740>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8699f1a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff88de37e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff86a67d10>
                     └ <function get_request_handler.<locals>.app at 0xffff88de36a0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff8c6b3240>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff8c5c5a80>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff8c5c54e0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff88e3e490>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaae9131480,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff88e3e490>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:00:41.826 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff8d6ad300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff8d6ad3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff8da8ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff8dabc410>
         │    └ <function Command.invoke at 0xffff8da8c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff8dabc410>
           │   │      │    └ <function main at 0xffff8d6bdc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8dcab920>
           └ <click.core.Context object at 0xffff8dabc410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff8d6bdc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff8da97240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff8db24720>
    └ <uvicorn.server.Server object at 0xffff8dc87590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff8db247c0>
           │       │   └ <uvicorn.server.Server object at 0xffff8dc87590>
           │       └ <function run at 0xffff8df93d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff8d6d49d0>
           │      └ <function Runner.run at 0xffff8dd6f9c0>
           └ <asyncio.runners.Runner object at 0xffff8d70fa90>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff8d6eda80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff8d70fa90>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8d728150>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a50a...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff896b6190>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8d728150>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a50a...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a50a...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff88e34210>
          └ <fastapi.applications.FastAPI object at 0xffff896b6190>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff8699de40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff88e34210>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff86a271a0>
                     │    │             └ <starlette.requests.Request object at 0xffff86a71210>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff86a71210>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff86a271a0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff86a26fc0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a259e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff88dda710>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff86a26fc0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a259e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff88fb1f50>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff88dda710>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a27560>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a259e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff88fb1950>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff88fb1f50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a27560>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a259e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff88f72cd0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff88fb1950>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a27560>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a259e0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff8c258900>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a27560>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a259e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff88de37e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff86a71250>
                     └ <function get_request_handler.<locals>.app at 0xffff88de36a0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff8c6b3240>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff8c5c5a80>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff8c5c54e0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff88e3e490>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaae9131480,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff88e3e490>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:00:41.846 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff8d6ad300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff8d6ad3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff8da8ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff8dabc410>
         │    └ <function Command.invoke at 0xffff8da8c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff8dabc410>
           │   │      │    └ <function main at 0xffff8d6bdc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8dcab920>
           └ <click.core.Context object at 0xffff8dabc410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff8d6bdc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff8da97240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff8db24720>
    └ <uvicorn.server.Server object at 0xffff8dc87590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff8db247c0>
           │       │   └ <uvicorn.server.Server object at 0xffff8dc87590>
           │       └ <function run at 0xffff8df93d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff8d6d49d0>
           │      └ <function Runner.run at 0xffff8dd6f9c0>
           └ <asyncio.runners.Runner object at 0xffff8d70fa90>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff8d6eda80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff8d70fa90>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8d728150>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a71c...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff896b6190>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8d728150>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a71c...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a71c...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff88e34210>
          └ <fastapi.applications.FastAPI object at 0xffff896b6190>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff86a25940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff88e34210>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff86a27060>
                     │    │             └ <starlette.requests.Request object at 0xffff86a72cd0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff86a72cd0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff86a27060>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff86a27c40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a26700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff88dda710>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff86a27c40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a26700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff88fb1f50>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff88dda710>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a26a20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a26700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff88fb1950>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff88fb1f50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a26a20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a26700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff88f72cd0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff88fb1950>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a26a20>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a26700>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff8c258900>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a26a20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a26700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff88de37e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff86a72710>
                     └ <function get_request_handler.<locals>.app at 0xffff88de36a0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff8c6b3240>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff8c5c5a80>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff8c5c54e0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff88e3e490>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaae9131480,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff88e3e490>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:00:41.867 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff8d6ad300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff8d6ad3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff8da8ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff8dabc410>
         │    └ <function Command.invoke at 0xffff8da8c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff8dabc410>
           │   │      │    └ <function main at 0xffff8d6bdc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8dcab920>
           └ <click.core.Context object at 0xffff8dabc410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff8d6bdc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff8da97240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff8db24720>
    └ <uvicorn.server.Server object at 0xffff8dc87590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff8db247c0>
           │       │   └ <uvicorn.server.Server object at 0xffff8dc87590>
           │       └ <function run at 0xffff8df93d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff8d6d49d0>
           │      └ <function Runner.run at 0xffff8dd6f9c0>
           └ <asyncio.runners.Runner object at 0xffff8d70fa90>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff8d6eda80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff8d70fa90>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8d728150>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a64e...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff896b6190>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8d728150>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a64e...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a64e...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff88e34210>
          └ <fastapi.applications.FastAPI object at 0xffff896b6190>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff8699f1a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff86a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff88e34210>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff86a27e20>
                     │    │             └ <starlette.requests.Request object at 0xffff86a671d0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff86a671d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff86a27e20>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff86a26ac0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a258a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff88dda710>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff89024e50>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff86a26ac0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a258a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff88fb1f50>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff88dda710>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a271a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a258a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff88fb1950>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff88fb1f50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a271a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a258a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff88f72cd0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff88fb1950>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a271a0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a258a0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff8c258900>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff86a271a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff86a258a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff88de37e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff86a66310>
                     └ <function get_request_handler.<locals>.app at 0xffff88de36a0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff8c6b3240>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff8c5c5a80>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff8c5c54e0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff88e3e490>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaae9131480,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff88e3e490>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:00:41.899 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:11.598 | INFO     | app.main:lifespan:53 - 应用关闭中...
2025-11-24 03:01:11.605 | INFO     | app.main:lifespan:57 - 数据库连接已关闭
2025-11-24 03:01:11.606 | INFO     | app.main:lifespan:61 - Redis 连接已关闭
2025-11-24 03:01:12.506 | INFO     | app.main:lifespan:38 - 应用启动中...
2025-11-24 03:01:12.506 | INFO     | app.main:lifespan:42 - 数据库连接已建立
2025-11-24 03:01:12.506 | INFO     | app.main:lifespan:46 - Redis 连接已建立
2025-11-24 03:01:12.507 | INFO     | app.main:lifespan:48 - Medical AI Platform v1.0.0 启动成功
2025-11-24 03:01:32.406 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:32.428 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:32.450 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:32.465 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:32.487 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:32.501 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:32.522 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:32.536 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:32.554 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:32.572 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:32.587 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:32.606 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:32.619 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:32.634 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:32.652 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:32.669 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:32.683 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:32.699 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:32.716 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:32.727 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:49.071 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:49.097 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:49.118 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:49.135 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:49.156 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:49.169 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:49.188 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:49.202 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:49.221 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:49.238 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:49.252 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:49.266 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:49.280 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:49.295 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:49.308 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:49.323 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:49.337 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:49.350 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:49.365 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:01:49.376 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:04:45.059 | INFO     | app.main:lifespan:53 - 应用关闭中...
2025-11-24 03:04:45.060 | INFO     | app.main:lifespan:57 - 数据库连接已关闭
2025-11-24 03:04:45.061 | INFO     | app.main:lifespan:61 - Redis 连接已关闭
2025-11-24 03:04:46.524 | INFO     | app.main:lifespan:38 - 应用启动中...
2025-11-24 03:04:46.524 | INFO     | app.main:lifespan:42 - 数据库连接已建立
2025-11-24 03:04:46.524 | INFO     | app.main:lifespan:46 - Redis 连接已建立
2025-11-24 03:04:46.524 | INFO     | app.main:lifespan:48 - Medical AI Platform v1.0.0 启动成功
2025-11-24 03:05:16.197 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.application.Application'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff8cb1d300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff8cb1d3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff8cefca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff8cf2c410>
         │    └ <function Command.invoke at 0xffff8cefc720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff8cf2c410>
           │   │      │    └ <function main at 0xffff8cb2dc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8d11b920>
           └ <click.core.Context object at 0xffff8cf2c410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff8cb2dc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff8cf07240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff8cf94720>
    └ <uvicorn.server.Server object at 0xffff8d0f7590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff8cf947c0>
           │       │   └ <uvicorn.server.Server object at 0xffff8d0f7590>
           │       └ <function run at 0xffff8d403d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff8cb409d0>
           │      └ <function Runner.run at 0xffff8d1df9c0>
           └ <asyncio.runners.Runner object at 0xffff8cb7fa10>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff8cb5da80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff8cb7fa10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8903ef50>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff860962...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff860...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff8b765c90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8903ef50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff860962...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff860...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff860962...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff860...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8943dd10>
          └ <fastapi.applications.FastAPI object at 0xffff8b765c90>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff86008360>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff860...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8943dd10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff8a54df80>
                     │    │             └ <starlette.requests.Request object at 0xffff860c9150>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff860c9150>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff8a54df80>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.application.Application'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff883276a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff88327060>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff883cfe90>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff883276a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff88327060>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff883cfa10>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff883cfe90>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff860927a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff88327060>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff883cfa50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff883cfa10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff860927a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff88327060>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff88421690>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff883cfa50>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff860927a0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff88327060>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff8b6c8900>
          └ APIRoute(path='/api/v1/applications', name='list_applications', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff860927a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff88327060>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff8824cf40>
          └ APIRoute(path='/api/v1/applications', name='list_applications', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff860c9810>
                     └ <function get_request_handler.<locals>.app at 0xffff8824c220>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff8bb23240>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff8bc69a80>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_applications_api_v1_applica...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff8bc694e0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff8825cc50>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_applications_api_v1_applica...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaae0bb4af0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff8825cc50>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.application.Application'>
2025-11-24 03:05:16.247 | INFO     | app.services.conversation_service:create_conversation:39 - 创建会话: e1df31e9-1c21-4b47-81a2-7c3a7522a7ae, 用户: b3a84fe3-4aa5-4fab-a85e-5fb0e21fce93
2025-11-24 03:05:16.267 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff8cb1d300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff8cb1d3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff8cefca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff8cf2c410>
         │    └ <function Command.invoke at 0xffff8cefc720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff8cf2c410>
           │   │      │    └ <function main at 0xffff8cb2dc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8d11b920>
           └ <click.core.Context object at 0xffff8cf2c410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff8cb2dc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff8cf07240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff8cf94720>
    └ <uvicorn.server.Server object at 0xffff8d0f7590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff8cf947c0>
           │       │   └ <uvicorn.server.Server object at 0xffff8d0f7590>
           │       └ <function run at 0xffff8d403d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff8cb409d0>
           │      └ <function Runner.run at 0xffff8d1df9c0>
           └ <asyncio.runners.Runner object at 0xffff8cb7fa10>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff8cb5da80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff8cb7fa10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8903ef50>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e7fc...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff8b765c90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8903ef50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e7fc...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e7fc...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8943dd10>
          └ <fastapi.applications.FastAPI object at 0xffff8b765c90>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff85e0a2a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8943dd10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff85e09c60>
                     │    │             └ <starlette.requests.Request object at 0xffff85e7fa90>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff85e7fa90>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff85e09c60>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff85e0a160>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e0a980>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff883cfe90>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff85e0a160>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e0a980>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff883cfa10>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff883cfe90>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e0a020>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e0a980>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff883cfa50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff883cfa10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e0a020>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e0a980>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff88421690>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff883cfa50>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e0a020>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e0a980>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff8b6c8900>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e0a020>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e0a980>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff8824f7e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff85e8fb90>
                     └ <function get_request_handler.<locals>.app at 0xffff8824f6a0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff8bb23240>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff8bc69a80>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff8bc694e0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff882ae350>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaae0bb4af0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff882ae350>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:05:16.311 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff8cb1d300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff8cb1d3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff8cefca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff8cf2c410>
         │    └ <function Command.invoke at 0xffff8cefc720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff8cf2c410>
           │   │      │    └ <function main at 0xffff8cb2dc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8d11b920>
           └ <click.core.Context object at 0xffff8cf2c410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff8cb2dc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff8cf07240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff8cf94720>
    └ <uvicorn.server.Server object at 0xffff8d0f7590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff8cf947c0>
           │       │   └ <uvicorn.server.Server object at 0xffff8d0f7590>
           │       └ <function run at 0xffff8d403d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff8cb409d0>
           │      └ <function Runner.run at 0xffff8d1df9c0>
           └ <asyncio.runners.Runner object at 0xffff8cb7fa10>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff8cb5da80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff8cb7fa10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8903ef50>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85eb16...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff8b765c90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8903ef50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85eb16...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85eb16...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8943dd10>
          └ <fastapi.applications.FastAPI object at 0xffff8b765c90>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff85e09b20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8943dd10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff85e0b380>
                     │    │             └ <starlette.requests.Request object at 0xffff85eb1910>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff85eb1910>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff85e0b380>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff85e0b240>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e0b1a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff883cfe90>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff85e0b240>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e0b1a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff883cfa10>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff883cfe90>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e95bc0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e0b1a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff883cfa50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff883cfa10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e95bc0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e0b1a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff88421690>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff883cfa50>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e95bc0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e0b1a0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff8b6c8900>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e95bc0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e0b1a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff8824f7e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff85ebca90>
                     └ <function get_request_handler.<locals>.app at 0xffff8824f6a0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff8bb23240>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff8bc69a80>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff8bc694e0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff882ae350>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaae0bb4af0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff882ae350>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:05:16.335 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff8cb1d300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff8cb1d3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff8cefca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff8cf2c410>
         │    └ <function Command.invoke at 0xffff8cefc720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff8cf2c410>
           │   │      │    └ <function main at 0xffff8cb2dc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8d11b920>
           └ <click.core.Context object at 0xffff8cf2c410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff8cb2dc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff8cf07240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff8cf94720>
    └ <uvicorn.server.Server object at 0xffff8d0f7590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff8cf947c0>
           │       │   └ <uvicorn.server.Server object at 0xffff8d0f7590>
           │       └ <function run at 0xffff8d403d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff8cb409d0>
           │      └ <function Runner.run at 0xffff8d1df9c0>
           └ <asyncio.runners.Runner object at 0xffff8cb7fa10>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff8cb5da80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff8cb7fa10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8903ef50>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85ebe9...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff8b765c90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8903ef50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85ebe9...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85ebe9...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8943dd10>
          └ <fastapi.applications.FastAPI object at 0xffff8b765c90>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff85e96840>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8943dd10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff85e94ea0>
                     │    │             └ <starlette.requests.Request object at 0xffff85ebda90>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff85ebda90>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff85e94ea0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff85e95760>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e96160>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff883cfe90>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff85e95760>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e96160>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff883cfa10>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff883cfe90>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e96200>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e96160>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff883cfa50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff883cfa10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e96200>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e96160>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff88421690>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff883cfa50>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e96200>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e96160>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff8b6c8900>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e96200>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e96160>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff8824f7e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff85ebe250>
                     └ <function get_request_handler.<locals>.app at 0xffff8824f6a0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff8bb23240>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff8bc69a80>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff8bc694e0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff882ae350>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaae0bb4af0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff882ae350>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:05:16.357 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff8cb1d300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff8cb1d3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff8cefca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff8cf2c410>
         │    └ <function Command.invoke at 0xffff8cefc720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff8cf2c410>
           │   │      │    └ <function main at 0xffff8cb2dc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8d11b920>
           └ <click.core.Context object at 0xffff8cf2c410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff8cb2dc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff8cf07240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff8cf94720>
    └ <uvicorn.server.Server object at 0xffff8d0f7590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff8cf947c0>
           │       │   └ <uvicorn.server.Server object at 0xffff8d0f7590>
           │       └ <function run at 0xffff8d403d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff8cb409d0>
           │      └ <function Runner.run at 0xffff8d1df9c0>
           └ <asyncio.runners.Runner object at 0xffff8cb7fa10>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff8cb5da80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff8cb7fa10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8903ef50>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85ec0d...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff8b765c90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8903ef50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85ec0d...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85ec0d...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8943dd10>
          └ <fastapi.applications.FastAPI object at 0xffff8b765c90>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff85e972e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8943dd10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff85e96f20>
                     │    │             └ <starlette.requests.Request object at 0xffff85ec1550>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff85ec1550>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff85e96f20>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff85e95c60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e96d40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff883cfe90>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff85e95c60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e96d40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff883cfa10>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff883cfe90>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e96c00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e96d40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff883cfa50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff883cfa10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e96c00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e96d40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff88421690>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff883cfa50>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e96c00>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e96d40>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff8b6c8900>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e96c00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e96d40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff8824f7e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff85ec0890>
                     └ <function get_request_handler.<locals>.app at 0xffff8824f6a0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff8bb23240>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff8bc69a80>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff8bc694e0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff882ae350>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaae0bb4af0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff882ae350>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:05:16.378 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff8cb1d300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff8cb1d3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff8cefca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff8cf2c410>
         │    └ <function Command.invoke at 0xffff8cefc720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff8cf2c410>
           │   │      │    └ <function main at 0xffff8cb2dc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8d11b920>
           └ <click.core.Context object at 0xffff8cf2c410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff8cb2dc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff8cf07240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff8cf94720>
    └ <uvicorn.server.Server object at 0xffff8d0f7590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff8cf947c0>
           │       │   └ <uvicorn.server.Server object at 0xffff8d0f7590>
           │       └ <function run at 0xffff8d403d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff8cb409d0>
           │      └ <function Runner.run at 0xffff8d1df9c0>
           └ <asyncio.runners.Runner object at 0xffff8cb7fa10>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff8cb5da80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff8cb7fa10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8903ef50>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85ebed...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff8b765c90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8903ef50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85ebed...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85ebed...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8943dd10>
          └ <fastapi.applications.FastAPI object at 0xffff8b765c90>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff85e0b4c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8943dd10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff85e0b240>
                     │    │             └ <starlette.requests.Request object at 0xffff85ebcb90>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff85ebcb90>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff85e0b240>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff85e0bb00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e09b20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff883cfe90>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff85e0bb00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e09b20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff883cfa10>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff883cfe90>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e97740>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e09b20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff883cfa50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff883cfa10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e97740>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e09b20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff88421690>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff883cfa50>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e97740>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e09b20>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff8b6c8900>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e97740>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e09b20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff8824f7e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff85ebed50>
                     └ <function get_request_handler.<locals>.app at 0xffff8824f6a0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff8bb23240>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff8bc69a80>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff8bc694e0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff882ae350>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaae0bb4af0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff882ae350>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:05:16.399 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff8cb1d300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff8cb1d3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff8cefca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff8cf2c410>
         │    └ <function Command.invoke at 0xffff8cefc720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff8cf2c410>
           │   │      │    └ <function main at 0xffff8cb2dc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8d11b920>
           └ <click.core.Context object at 0xffff8cf2c410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff8cb2dc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff8cf07240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff8cf94720>
    └ <uvicorn.server.Server object at 0xffff8d0f7590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff8cf947c0>
           │       │   └ <uvicorn.server.Server object at 0xffff8d0f7590>
           │       └ <function run at 0xffff8d403d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff8cb409d0>
           │      └ <function Runner.run at 0xffff8d1df9c0>
           └ <asyncio.runners.Runner object at 0xffff8cb7fa10>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff8cb5da80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff8cb7fa10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8903ef50>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85eb29...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff8b765c90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8903ef50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85eb29...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85eb29...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8943dd10>
          └ <fastapi.applications.FastAPI object at 0xffff8b765c90>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff85e971a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8943dd10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff85e976a0>
                     │    │             └ <starlette.requests.Request object at 0xffff85eb2ed0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff85eb2ed0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff85e976a0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff85e97600>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e96840>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff883cfe90>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff85e97600>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e96840>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff883cfa10>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff883cfe90>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e97b00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e96840>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff883cfa50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff883cfa10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e97b00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e96840>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff88421690>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff883cfa50>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e97b00>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e96840>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff8b6c8900>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e97b00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e96840>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff8824f7e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff85ec0490>
                     └ <function get_request_handler.<locals>.app at 0xffff8824f6a0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff8bb23240>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff8bc69a80>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff8bc694e0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff882ae350>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaae0bb4af0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff882ae350>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:05:16.420 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff8cb1d300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff8cb1d3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff8cefca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff8cf2c410>
         │    └ <function Command.invoke at 0xffff8cefc720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff8cf2c410>
           │   │      │    └ <function main at 0xffff8cb2dc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8d11b920>
           └ <click.core.Context object at 0xffff8cf2c410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff8cb2dc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff8cf07240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff8cf94720>
    └ <uvicorn.server.Server object at 0xffff8d0f7590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff8cf947c0>
           │       │   └ <uvicorn.server.Server object at 0xffff8d0f7590>
           │       └ <function run at 0xffff8d403d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff8cb409d0>
           │      └ <function Runner.run at 0xffff8d1df9c0>
           └ <asyncio.runners.Runner object at 0xffff8cb7fa10>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff8cb5da80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff8cb7fa10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8903ef50>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85ec0c...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff8b765c90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8903ef50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85ec0c...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85ec0c...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8943dd10>
          └ <fastapi.applications.FastAPI object at 0xffff8b765c90>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff85e97a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8943dd10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff85e96fc0>
                     │    │             └ <starlette.requests.Request object at 0xffff85ec3f10>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff85ec3f10>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff85e96fc0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff85e95f80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e967a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff883cfe90>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff85e95f80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e967a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff883cfa10>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff883cfe90>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e94ea0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e967a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff883cfa50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff883cfa10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e94ea0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e967a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff88421690>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff883cfa50>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e94ea0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e967a0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff8b6c8900>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e94ea0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e967a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff8824f7e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff85ec3250>
                     └ <function get_request_handler.<locals>.app at 0xffff8824f6a0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff8bb23240>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff8bc69a80>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff8bc694e0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff882ae350>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaae0bb4af0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff882ae350>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:05:16.440 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff8cb1d300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff8cb1d3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff8cefca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff8cf2c410>
         │    └ <function Command.invoke at 0xffff8cefc720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff8cf2c410>
           │   │      │    └ <function main at 0xffff8cb2dc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8d11b920>
           └ <click.core.Context object at 0xffff8cf2c410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff8cb2dc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff8cf07240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff8cf94720>
    └ <uvicorn.server.Server object at 0xffff8d0f7590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff8cf947c0>
           │       │   └ <uvicorn.server.Server object at 0xffff8d0f7590>
           │       └ <function run at 0xffff8d403d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff8cb409d0>
           │      └ <function Runner.run at 0xffff8d1df9c0>
           └ <asyncio.runners.Runner object at 0xffff8cb7fa10>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff8cb5da80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff8cb7fa10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8903ef50>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85ec1f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff8b765c90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8903ef50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85ec1f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85ec1f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8943dd10>
          └ <fastapi.applications.FastAPI object at 0xffff8b765c90>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff85e96de0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8943dd10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff85e97ce0>
                     │    │             └ <starlette.requests.Request object at 0xffff85eb17d0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff85eb17d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff85e97ce0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff85e97380>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e97420>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff883cfe90>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff85e97380>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e97420>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff883cfa10>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff883cfe90>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e95d00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e97420>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff883cfa50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff883cfa10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e95d00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e97420>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff88421690>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff883cfa50>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e95d00>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e97420>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff8b6c8900>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e95d00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e97420>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff8824f7e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff85eb0e50>
                     └ <function get_request_handler.<locals>.app at 0xffff8824f6a0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff8bb23240>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff8bc69a80>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff8bc694e0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff882ae350>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaae0bb4af0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff882ae350>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:05:16.462 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff8cb1d300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff8cb1d3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff8cefca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff8cf2c410>
         │    └ <function Command.invoke at 0xffff8cefc720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff8cf2c410>
           │   │      │    └ <function main at 0xffff8cb2dc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8d11b920>
           └ <click.core.Context object at 0xffff8cf2c410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff8cb2dc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff8cf07240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff8cf94720>
    └ <uvicorn.server.Server object at 0xffff8d0f7590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff8cf947c0>
           │       │   └ <uvicorn.server.Server object at 0xffff8d0f7590>
           │       └ <function run at 0xffff8d403d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff8cb409d0>
           │      └ <function Runner.run at 0xffff8d1df9c0>
           └ <asyncio.runners.Runner object at 0xffff8cb7fa10>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff8cb5da80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff8cb7fa10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8903ef50>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85ebff...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff8b765c90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8903ef50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85ebff...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85ebff...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8943dd10>
          └ <fastapi.applications.FastAPI object at 0xffff8b765c90>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff85e97f60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8943dd10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff85e95b20>
                     │    │             └ <starlette.requests.Request object at 0xffff85ebccd0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff85ebccd0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff85e95b20>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff85e96700>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e97740>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff883cfe90>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff85e96700>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e97740>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff883cfa10>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff883cfe90>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e97ec0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e97740>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff883cfa50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff883cfa10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e97ec0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e97740>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff88421690>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff883cfa50>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e97ec0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e97740>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff8b6c8900>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e97ec0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e97740>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff8824f7e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff85edc490>
                     └ <function get_request_handler.<locals>.app at 0xffff8824f6a0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff8bb23240>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff8bc69a80>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff8bc694e0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff882ae350>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaae0bb4af0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff882ae350>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:05:16.483 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff8cb1d300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff8cb1d3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff8cefca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff8cf2c410>
         │    └ <function Command.invoke at 0xffff8cefc720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff8cf2c410>
           │   │      │    └ <function main at 0xffff8cb2dc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8d11b920>
           └ <click.core.Context object at 0xffff8cf2c410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff8cb2dc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff8cf07240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff8cf94720>
    └ <uvicorn.server.Server object at 0xffff8d0f7590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff8cf947c0>
           │       │   └ <uvicorn.server.Server object at 0xffff8d0f7590>
           │       └ <function run at 0xffff8d403d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff8cb409d0>
           │      └ <function Runner.run at 0xffff8d1df9c0>
           └ <asyncio.runners.Runner object at 0xffff8cb7fa10>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff8cb5da80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff8cb7fa10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8903ef50>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85edf0...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff8b765c90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8903ef50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85edf0...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85edf0...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8943dd10>
          └ <fastapi.applications.FastAPI object at 0xffff8b765c90>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff85e0b380>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8943dd10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff85e0ae80>
                     │    │             └ <starlette.requests.Request object at 0xffff85edea50>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff85edea50>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff85e0ae80>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff85e96020>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e968e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff883cfe90>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff85e96020>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e968e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff883cfa10>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff883cfe90>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e0b240>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e968e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff883cfa50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff883cfa10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e0b240>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e968e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff88421690>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff883cfa50>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e0b240>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e968e0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff8b6c8900>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e0b240>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e968e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff8824f7e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff85ede690>
                     └ <function get_request_handler.<locals>.app at 0xffff8824f6a0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff8bb23240>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff8bc69a80>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff8bc694e0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff882ae350>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaae0bb4af0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff882ae350>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:05:16.504 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff8cb1d300>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff8cb1d3a0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff8cefca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff8cf2c410>
         │    └ <function Command.invoke at 0xffff8cefc720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff8cf2c410>
           │   │      │    └ <function main at 0xffff8cb2dc60>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8d11b920>
           └ <click.core.Context object at 0xffff8cf2c410>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff8cb2dc60>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff8cf07240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff8cf94720>
    └ <uvicorn.server.Server object at 0xffff8d0f7590>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff8cf947c0>
           │       │   └ <uvicorn.server.Server object at 0xffff8d0f7590>
           │       └ <function run at 0xffff8d403d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff8cb409d0>
           │      └ <function Runner.run at 0xffff8d1df9c0>
           └ <asyncio.runners.Runner object at 0xffff8cb7fa10>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff8cb5da80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff8cb7fa10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8903ef50>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85edd7...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff8b765c90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8903ef50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85edd7...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85edd7...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8943dd10>
          └ <fastapi.applications.FastAPI object at 0xffff8b765c90>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff85e971a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff85e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8943dd10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff85e95ee0>
                     │    │             └ <starlette.requests.Request object at 0xffff85eddcd0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff85eddcd0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff85e95ee0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff85e97f60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e97ba0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff883cfe90>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff882addd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff85e97f60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e97ba0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff883cfa10>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff883cfe90>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e0bf60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e97ba0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff883cfa50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff883cfa10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e0bf60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e97ba0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff88421690>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff883cfa50>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e0bf60>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e97ba0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff8b6c8900>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff85e0bf60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff85e97ba0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff8824f7e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff85edfa90>
                     └ <function get_request_handler.<locals>.app at 0xffff8824f6a0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff8bb23240>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff8bc69a80>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff8bc694e0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff882ae350>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaae0bb4af0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff882ae350>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:05:16.535 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:06:20.430 | INFO     | app.main:lifespan:53 - 应用关闭中...
2025-11-24 03:06:20.435 | INFO     | app.main:lifespan:57 - 数据库连接已关闭
2025-11-24 03:06:20.436 | INFO     | app.main:lifespan:61 - Redis 连接已关闭
2025-11-24 03:06:21.348 | INFO     | app.main:lifespan:38 - 应用启动中...
2025-11-24 03:06:21.348 | INFO     | app.main:lifespan:42 - 数据库连接已建立
2025-11-24 03:06:21.349 | INFO     | app.main:lifespan:46 - Redis 连接已建立
2025-11-24 03:06:21.349 | INFO     | app.main:lifespan:48 - Medical AI Platform v1.0.0 启动成功
2025-11-24 03:06:54.214 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.application.Application'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffadbf44...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffadb...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffadbf44...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffadb...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffadbf44...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffadb...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffadb97a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffadb...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffadb376a0>
                     │    │             └ <starlette.requests.Request object at 0xffffadbf7750>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffadbf7750>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffadb376a0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.application.Application'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffafe56520>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffadb36fc0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffafe56520>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffadb36fc0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadb97b00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffadb36fc0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadb97b00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffadb36fc0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadb97b00>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffadb36fc0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/applications', name='list_applications', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadb97b00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffadb36fc0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffafd80400>
          └ APIRoute(path='/api/v1/applications', name='list_applications', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffadbf6d10>
                     └ <function get_request_handler.<locals>.app at 0xffffafd80180>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_applications_api_v1_applica...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafdbfa50>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_applications_api_v1_applica...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafdbfa50>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.application.Application'>
2025-11-24 03:06:54.262 | INFO     | app.services.conversation_service:create_conversation:39 - 创建会话: 768d598b-a9eb-4b80-a2ce-8e80866ee177, 用户: 94713ef6-6b6b-4268-af8f-f1cbad1147f2
2025-11-24 03:06:54.283 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad99e6...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad99e6...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad99e6...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9a1120>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a1ee0>
                     │    │             └ <starlette.requests.Request object at 0xffffad9b8710>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad9b8710>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a1ee0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9a1620>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2fc0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9a1620>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2fc0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a22a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2fc0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a22a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2fc0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a22a0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2fc0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a22a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2fc0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad9b9890>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:06:54.325 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9d7a...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9d7a...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9d7a...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9a3ec0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a28e0>
                     │    │             └ <starlette.requests.Request object at 0xffffad9d7950>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad9d7950>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a28e0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9a2f20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2520>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9a2f20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2520>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2020>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2520>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2020>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2520>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2020>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2520>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2020>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2520>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad9e6410>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:06:54.348 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9e6f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9e6f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9e6f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d1d00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d1120>
                     │    │             └ <starlette.requests.Request object at 0xffffad9e7750>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad9e7750>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d1120>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d1080>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1300>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d1080>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1300>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d14e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1300>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d14e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1300>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d14e0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1300>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d14e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1300>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad9f8550>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:06:54.370 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9fa9...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9fa9...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9fa9...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d27a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d23e0>
                     │    │             └ <starlette.requests.Request object at 0xffffad9f9f10>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad9f9f10>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d23e0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d16c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1620>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d16c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1620>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2980>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1620>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2980>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1620>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2980>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1620>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2980>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1620>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad9fa190>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:06:54.389 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9e6e...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9e6e...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9e6e...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9a2a20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a3e20>
                     │    │             └ <starlette.requests.Request object at 0xffffad9e77d0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad9e77d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a3e20>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9a28e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2980>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9a28e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2980>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2c00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2980>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2c00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2980>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2c00>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2980>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2c00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2980>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad9d7090>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:06:54.410 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9f95...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9f95...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9f95...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d1440>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d2e80>
                     │    │             └ <starlette.requests.Request object at 0xffffad9f9810>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad9f9810>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d2e80>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d2b60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d2b60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d13a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d13a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d13a0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2700>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d13a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad9fbb10>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:06:54.431 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada011...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada011...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada011...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d1d00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d2f20>
                     │    │             └ <starlette.requests.Request object at 0xffffada01550>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffada01550>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d2f20>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d1bc0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1c60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d1bc0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1c60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d0d60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1c60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d0d60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1c60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d0d60>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1c60>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d0d60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1c60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffada00110>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:06:54.463 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9f89...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9f89...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9f89...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9a27a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a3e20>
                     │    │             └ <starlette.requests.Request object at 0xffffad9f8f10>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad9f8f10>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a3e20>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d2840>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2980>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d2840>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2980>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a3ec0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2980>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a3ec0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2980>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a3ec0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2980>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a3ec0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2980>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad9f8ad0>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:06:54.488 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada022...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada022...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada022...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d2340>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d34c0>
                     │    │             └ <starlette.requests.Request object at 0xffffada01b50>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffada01b50>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d34c0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d2e80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d2e80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d31a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d31a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d31a0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2700>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d31a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffada01650>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:06:54.512 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada025...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada025...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada025...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d14e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d0fe0>
                     │    │             └ <starlette.requests.Request object at 0xffffada001d0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffada001d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d0fe0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d36a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2a20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d36a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2a20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d3420>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2a20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d3420>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2a20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d3420>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2a20>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d3420>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2a20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffada0c610>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:06:54.533 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9fa8...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9fa8...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9fa8...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9a2980>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a3e20>
                     │    │             └ <starlette.requests.Request object at 0xffffad9fbc10>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad9fbc10>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a3e20>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d1800>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3ce0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d1800>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3ce0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a27a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3ce0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a27a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3ce0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a27a0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3ce0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a27a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3ce0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffada00290>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:06:54.564 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:08:15.758 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.application.Application'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad99e5...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad99e5...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad99e5...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d3240>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d2de0>
                     │    │             └ <starlette.requests.Request object at 0xffffad9d6210>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad9d6210>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d2de0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.application.Application'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d11c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d36a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d11c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d36a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d3d80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d36a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d3d80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d36a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d3d80>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d36a0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/applications', name='list_applications', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d3d80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d36a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffafd80400>
          └ APIRoute(path='/api/v1/applications', name='list_applications', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad9d6bd0>
                     └ <function get_request_handler.<locals>.app at 0xffffafd80180>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_applications_api_v1_applica...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafdbfa50>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_applications_api_v1_applica...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafdbfa50>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.application.Application'>
2025-11-24 03:08:15.802 | INFO     | app.services.conversation_service:create_conversation:39 - 创建会话: 120a2e97-509e-445e-8c8d-ab1b4d101ffd, 用户: 9ef39d55-ad5a-44df-9480-7878f16174df
2025-11-24 03:08:15.821 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9e51...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9e51...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9e51...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d32e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d2c00>
                     │    │             └ <starlette.requests.Request object at 0xffffad9e5050>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad9e5050>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d2c00>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d2660>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1da0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d2660>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1da0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2b60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1da0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2b60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1da0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2b60>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1da0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2b60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1da0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad9e56d0>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:08:15.865 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9d7a...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9d7a...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9d7a...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d3920>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d1580>
                     │    │             └ <starlette.requests.Request object at 0xffffad9d6a10>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad9d6a10>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d1580>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d2840>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d2840>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d36a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d36a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d36a0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2e80>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d36a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad9e4dd0>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:08:15.890 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada0f6...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada0f6...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada0f6...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d3380>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d2520>
                     │    │             └ <starlette.requests.Request object at 0xffffada0d450>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffada0d450>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d2520>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d2480>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3ba0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d2480>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3ba0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2700>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3ba0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2700>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3ba0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2700>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3ba0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2700>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3ba0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffada0e990>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:08:15.912 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada0ff...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada0ff...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada0ff...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d3060>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d3ce0>
                     │    │             └ <starlette.requests.Request object at 0xffffada0dcd0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffada0dcd0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d3ce0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d1300>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3920>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d1300>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3920>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2a20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3920>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2a20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3920>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2a20>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3920>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2a20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3920>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffada0c950>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:08:15.934 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada0db...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada0db...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada0db...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d11c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d2de0>
                     │    │             └ <starlette.requests.Request object at 0xffffad9d7b10>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad9d7b10>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d2de0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d2fc0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d13a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d2fc0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d13a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d1580>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d13a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d1580>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d13a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d1580>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d13a0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d1580>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d13a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad9d6210>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:08:15.956 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada03f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada03f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada03f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d2020>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d3c40>
                     │    │             └ <starlette.requests.Request object at 0xffffada03690>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffada03690>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d3c40>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d3600>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3420>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d3600>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3420>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d1120>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3420>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d1120>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3420>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d1120>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3420>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d1120>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3420>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffada020d0>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:08:15.976 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9e6e...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9e6e...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9e6e...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d28e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d3f60>
                     │    │             └ <starlette.requests.Request object at 0xffffad9d64d0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad9d64d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d3f60>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d0fe0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1620>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d0fe0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1620>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2f20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1620>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2f20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1620>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2f20>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1620>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2f20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1620>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad9d5950>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:08:15.997 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada0c2...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada0c2...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada0c2...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d3b00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d3100>
                     │    │             └ <starlette.requests.Request object at 0xffffada0d810>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffada0d810>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d3100>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d1d00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2ac0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d1d00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2ac0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d3e20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2ac0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d3e20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2ac0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d3e20>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2ac0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d3e20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2ac0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffada01810>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:08:16.017 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9fb7...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9fb7...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9fb7...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d2e80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d25c0>
                     │    │             └ <starlette.requests.Request object at 0xffffad9fbcd0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad9fbcd0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d25c0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d23e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d36a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d23e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d36a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2d40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d36a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2d40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d36a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2d40>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d36a0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2d40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d36a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad9f9f50>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:08:16.038 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada03a...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada03a...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada03a...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d1c60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d3a60>
                     │    │             └ <starlette.requests.Request object at 0xffffada01e50>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffada01e50>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d3a60>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d39c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2ac0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d39c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2ac0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d3100>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2ac0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d3100>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2ac0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d3100>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2ac0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d3100>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2ac0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffada0ca10>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:08:16.059 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9d63...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9d63...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9d63...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d3e20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d2980>
                     │    │             └ <starlette.requests.Request object at 0xffffad9d6bd0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad9d6bd0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d2980>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d1d00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3b00>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d1d00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3b00>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d1260>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3b00>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d1260>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3b00>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d1260>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3b00>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d1260>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3b00>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad9f82d0>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:08:16.090 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:08:28.233 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: 用户名或密码错误, 详情: None
2025-11-24 03:08:40.295 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.application.Application'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada029...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada029...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada029...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d2a20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d2660>
                     │    │             └ <starlette.requests.Request object at 0xffffad9f91d0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad9f91d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d2660>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.application.Application'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d02c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1c60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d02c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1c60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2fc0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1c60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2fc0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1c60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2fc0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1c60>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/applications', name='list_applications', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2fc0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1c60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffafd80400>
          └ APIRoute(path='/api/v1/applications', name='list_applications', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad9f8310>
                     └ <function get_request_handler.<locals>.app at 0xffffafd80180>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_applications_api_v1_applica...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafdbfa50>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_applications_api_v1_applica...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafdbfa50>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.application.Application'>
2025-11-24 03:08:40.341 | INFO     | app.services.conversation_service:create_conversation:39 - 创建会话: b7df44f1-0e4c-4336-a6e2-c74f8e5bc74b, 用户: 0723de9e-f64a-41af-bce7-81af43fdd8c7
2025-11-24 03:08:40.362 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffadbf5b...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffadb...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffadbf5b...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffadb...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffadbf5b...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffadb...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9a2160>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffadb...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a1620>
                     │    │             └ <starlette.requests.Request object at 0xffffada0fd90>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffada0fd90>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a1620>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9a1120>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2840>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9a1120>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2840>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a3060>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2840>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a3060>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2840>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a3060>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2840>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a3060>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2840>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffada0ca90>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:08:40.406 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada001...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada001...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada001...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9a1580>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a2480>
                     │    │             └ <starlette.requests.Request object at 0xffffad9b9550>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad9b9550>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a2480>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d3100>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a0f40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d3100>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a0f40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2660>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a0f40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2660>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a0f40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2660>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a0f40>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2660>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a0f40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad9f9b10>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:08:40.431 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada02c...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada02c...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada02c...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d3b00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d2c00>
                     │    │             └ <starlette.requests.Request object at 0xffffad9d7910>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad9d7910>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d2c00>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d22a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d28e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d22a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d28e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d1d00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d28e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d1d00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d28e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d1d00>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d28e0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d1d00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d28e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad9d74d0>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:08:40.454 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada01a...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada01a...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada01a...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d2fc0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d1260>
                     │    │             └ <starlette.requests.Request object at 0xffffad9fa0d0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad9fa0d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d1260>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d0fe0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3560>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d0fe0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3560>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a1d00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3560>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a1d00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3560>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a1d00>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3560>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a1d00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3560>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad9f9150>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:08:40.475 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad8200...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad8...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad8200...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad8...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad8200...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad8...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9a1620>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a1120>
                     │    │             └ <starlette.requests.Request object at 0xffffad821c10>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad821c10>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a1120>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9a1260>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2ac0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9a1260>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2ac0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d3a60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2ac0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d3a60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2ac0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d3a60>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2ac0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d3a60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2ac0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad821810>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:08:40.497 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada0ee...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada0ee...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada0ee...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffafe56ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a2520>
                     │    │             └ <starlette.requests.Request object at 0xffffada0c4d0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffada0c4d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a2520>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9a3ec0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a3060>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9a3ec0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a3060>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffafe56c00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a3060>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffafe56c00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a3060>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffafe56c00>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a3060>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffafe56c00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a3060>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffada01c50>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:08:40.518 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9e75...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9e75...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9e75...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9a2700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a18a0>
                     │    │             └ <starlette.requests.Request object at 0xffffad9d6250>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad9d6250>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a18a0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9a27a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2840>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9a27a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2840>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a1ee0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2840>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a1ee0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2840>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a1ee0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2840>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a1ee0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a2840>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad8202d0>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:08:40.539 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad8210...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad8...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad8210...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad8...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad8210...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad8...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d0fe0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d1260>
                     │    │             └ <starlette.requests.Request object at 0xffffad823750>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad823750>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d1260>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d1bc0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d20c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d1bc0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d20c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadb36fc0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d20c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadb36fc0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d20c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadb36fc0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d20c0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadb36fc0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d20c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad822750>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:08:40.559 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad99f8...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad99f8...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad99f8...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffadb97a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffafe56340>
                     │    │             └ <starlette.requests.Request object at 0xffffad99d550>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad99d550>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffafe56340>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffadbc2700>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffafe56520>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffadbc2700>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffafe56520>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadb97b00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffafe56520>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadb97b00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffafe56520>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadb97b00>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffafe56520>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadb97b00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffafe56520>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffaff4a650>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:08:40.580 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9d65...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9d65...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9d65...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9a2700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a3e20>
                     │    │             └ <starlette.requests.Request object at 0xffffad9d7110>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad9d7110>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a3e20>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9a2160>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a16c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9a2160>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a16c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadc06840>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a16c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadc06840>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a16c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadc06840>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a16c0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadc06840>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a16c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad9d7010>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:08:40.602 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad823f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad8...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad823f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad8...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad823f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad8...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9a2fc0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a3ec0>
                     │    │             └ <starlette.requests.Request object at 0xffffad822cd0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad822cd0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a3ec0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9a1080>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a0f40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9a1080>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a0f40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a27a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a0f40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a27a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a0f40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a27a0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a0f40>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a27a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a0f40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad822ed0>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:08:40.634 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:09:10.222 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.application.Application'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9d66...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9d66...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9d66...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9a2340>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a16c0>
                     │    │             └ <starlette.requests.Request object at 0xffffad8217d0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad8217d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a16c0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.application.Application'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d3a60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3100>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d3a60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3100>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d23e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3100>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d23e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3100>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d23e0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3100>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/applications', name='list_applications', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d23e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3100>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffafd80400>
          └ APIRoute(path='/api/v1/applications', name='list_applications', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad9fbf90>
                     └ <function get_request_handler.<locals>.app at 0xffffafd80180>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_applications_api_v1_applica...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafdbfa50>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_applications_api_v1_applica...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafdbfa50>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.application.Application'>
2025-11-24 03:09:10.269 | INFO     | app.services.conversation_service:create_conversation:39 - 创建会话: 5c371c27-596b-4157-b62f-bd41b07ce2cf, 用户: 564b14b1-143a-493f-8ccc-cc1f23ae9e98
2025-11-24 03:09:10.288 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad99d6...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad99d6...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad99d6...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9a2520>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a1ee0>
                     │    │             └ <starlette.requests.Request object at 0xffffad9fb450>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad9fb450>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a1ee0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9a2f20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a3060>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9a2f20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a3060>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a1d00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a3060>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a1d00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a3060>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a1d00>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a3060>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a1d00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a3060>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad9fbcd0>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:09:10.333 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad821a...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad8...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad821a...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad8...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad821a...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad8...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d11c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d3920>
                     │    │             └ <starlette.requests.Request object at 0xffffada01790>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffada01790>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d3920>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d1620>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d22a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d1620>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d22a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a22a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d22a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a22a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d22a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a22a0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d22a0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a22a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d22a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffada01dd0>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:09:10.356 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad99d4...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad99d4...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad99d4...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9a3e20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a1ee0>
                     │    │             └ <starlette.requests.Request object at 0xffffadc001d0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffadc001d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a1ee0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9a3060>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a25c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9a3060>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a25c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadc06840>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a25c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadc06840>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a25c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadc06840>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a25c0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadc06840>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a25c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad8211d0>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:09:10.378 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9fa0...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9fa0...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9fa0...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9a1620>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffad9...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a2700>
                     │    │             └ <starlette.requests.Request object at 0xffffad9f9210>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad9f9210>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a2700>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d2660>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a1580>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d2660>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a1580>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffafe56520>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a1580>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffafe56520>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a1580>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffafe56520>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a1580>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffafe56520>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a1580>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffada02990>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:09:10.400 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada0c7...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada0c7...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada0c7...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d13a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d2340>
                     │    │             └ <starlette.requests.Request object at 0xffffada0f410>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffada0f410>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d2340>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d3060>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2160>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d3060>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2160>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d02c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2160>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d02c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2160>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d02c0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2160>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d02c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2160>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffada0f010>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:09:10.418 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada0ef...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada0ef...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada0ef...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9a3060>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a2700>
                     │    │             └ <starlette.requests.Request object at 0xffffada0efd0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffada0efd0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a2700>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9a25c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a18a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9a25c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a18a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadc06840>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a18a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadc06840>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a18a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadc06840>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a18a0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadc06840>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a18a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffada0ff50>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:09:10.439 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada03f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada03f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada03f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d3600>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d3ce0>
                     │    │             └ <starlette.requests.Request object at 0xffffad9fa910>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffad9fa910>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d3ce0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d1da0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2020>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d1da0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2020>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a28e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2020>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a28e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2020>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a28e0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2020>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a28e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d2020>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad9fad10>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:09:10.460 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada19a...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada19a...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada19a...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d3b00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d3880>
                     │    │             └ <starlette.requests.Request object at 0xffffada1a290>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffada1a290>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d3880>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d3c40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d25c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d3c40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d25c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2840>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d25c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2840>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d25c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2840>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d25c0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d2840>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d25c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffada19750>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:09:10.481 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada03c...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada03c...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada03c...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d3380>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d3ba0>
                     │    │             └ <starlette.requests.Request object at 0xffffada00d10>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffada00d10>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d3ba0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d1440>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1120>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d1440>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1120>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadc06840>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1120>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadc06840>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1120>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadc06840>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1120>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffadc06840>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d1120>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffad9f8050>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:09:10.502 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada0d6...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada0d6...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada0d6...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d3740>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d16c0>
                     │    │             └ <starlette.requests.Request object at 0xffffada0d7d0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffada0d7d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9d16c0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d1d00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3ec0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9d1d00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3ec0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d1da0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3ec0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d1da0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3ec0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d1da0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3ec0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9d1da0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9d3ec0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffada1b1d0>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:09:10.522 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffffb468cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffffb468cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb4a6ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb5d52050>
         │    └ <function Command.invoke at 0xffffb4a6c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb5d52050>
           │   │      │    └ <function main at 0xffffb469d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb4c8b920>
           └ <click.core.Context object at 0xffffb5d52050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb469d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffffb4a77240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffffb4b00720>
    └ <uvicorn.server.Server object at 0xffffb4c789d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb4b007c0>
           │       │   └ <uvicorn.server.Server object at 0xffffb4c789d0>
           │       └ <function run at 0xffffb4f73d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb46acae0>
           │      └ <function Runner.run at 0xffffb4d4f9c0>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb46d1840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb46eb950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada1af...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb0307110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffffb009ec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada1af...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada1af...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
          └ <fastapi.applications.FastAPI object at 0xffffb0307110>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffad9d3600>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffffada...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffffaff0a890>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a18a0>
                     │    │             └ <starlette.requests.Request object at 0xffffada1b5d0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffffada1b5d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffffad9a18a0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9a3e20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a1ee0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffffaff0b610>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffffad9a3e20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a1ee0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffffb009e8d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a25c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a1ee0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffffb0aaa250>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a25c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a1ee0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffffb0aac650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffffb009e990>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a25c0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a1ee0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffffb31f00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffffad9a25c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffffad9a1ee0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffffaff05da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffffada19010>
                     └ <function get_request_handler.<locals>.app at 0xffffaff068e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb3656a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffffb3575260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffffb3574cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaaf2465da0,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffffafddd510>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:09:10.554 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:09:58.658 | INFO     | app.main:lifespan:53 - 应用关闭中...
2025-11-24 03:09:58.663 | INFO     | app.main:lifespan:57 - 数据库连接已关闭
2025-11-24 03:09:58.664 | INFO     | app.main:lifespan:61 - Redis 连接已关闭
2025-11-24 03:09:59.555 | INFO     | app.main:lifespan:38 - 应用启动中...
2025-11-24 03:09:59.556 | INFO     | app.main:lifespan:42 - 数据库连接已建立
2025-11-24 03:09:59.556 | INFO     | app.main:lifespan:46 - Redis 连接已建立
2025-11-24 03:09:59.556 | INFO     | app.main:lifespan:48 - Medical AI Platform v1.0.0 启动成功
2025-11-24 03:10:25.733 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.application.Application'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff81a3cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff81a3cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff81e1ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff83102050>
         │    └ <function Command.invoke at 0xffff81e1c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff83102050>
           │   │      │    └ <function main at 0xffff81a4d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8203b920>
           └ <click.core.Context object at 0xffff83102050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff81a4d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff81e27240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff81eb0720>
    └ <uvicorn.server.Server object at 0xffff820289d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff81eb07c0>
           │       │   └ <uvicorn.server.Server object at 0xffff820289d0>
           │       └ <function run at 0xffff82323d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff81a5cae0>
           │      └ <function Runner.run at 0xffff820ff9c0>
           └ <asyncio.runners.Runner object at 0xffff81a9b950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff81a81840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff81a9b950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7d2fec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7af9f8...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7af...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff7d2b5b50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7d2fec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7af9f8...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7af...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7af9f8...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7af...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7d131e10>
          └ <fastapi.applications.FastAPI object at 0xffff7d2b5b50>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff7af47b00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7af...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7d131e10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7af46020>
                     │    │             └ <starlette.requests.Request object at 0xffff7af9f7d0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff7af9f7d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7af46020>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.application.Application'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7aeeaf20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7af474c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7d2b7e10>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7aeeaf20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7af474c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7d451050>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7d2b7e10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7af47a60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7af474c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff7d2b6e50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7d451050>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7af47a60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7af474c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff7d450f50>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff7d2b6e50>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7af47a60>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7af474c0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff805a00e0>
          └ APIRoute(path='/api/v1/applications', name='list_applications', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7af47a60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7af474c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff7d12c400>
          └ APIRoute(path='/api/v1/applications', name='list_applications', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff7afbe490>
                     └ <function get_request_handler.<locals>.app at 0xffff7d12c180>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff80a06a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff80925260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_applications_api_v1_applica...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff80924cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff7d168050>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_applications_api_v1_applica...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaafcdd2e80,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff7d168050>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.application.Application'>
2025-11-24 03:10:25.784 | INFO     | app.services.conversation_service:create_conversation:39 - 创建会话: f247feda-7c21-4069-a753-2617b4e8383a, 用户: 5dcd25e7-d4cb-4944-ac90-cf3905277a87
2025-11-24 03:10:25.803 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff81a3cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff81a3cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff81e1ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff83102050>
         │    └ <function Command.invoke at 0xffff81e1c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff83102050>
           │   │      │    └ <function main at 0xffff81a4d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8203b920>
           └ <click.core.Context object at 0xffff83102050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff81a4d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff81e27240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff81eb0720>
    └ <uvicorn.server.Server object at 0xffff820289d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff81eb07c0>
           │       │   └ <uvicorn.server.Server object at 0xffff820289d0>
           │       └ <function run at 0xffff82323d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff81a5cae0>
           │      └ <function Runner.run at 0xffff820ff9c0>
           └ <asyncio.runners.Runner object at 0xffff81a9b950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff81a81840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff81a9b950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7d2fec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad49f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff7d2b5b50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7d2fec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad49f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad49f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7d131e10>
          └ <fastapi.applications.FastAPI object at 0xffff7d2b5b50>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff7ad51800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7d131e10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7ad51120>
                     │    │             └ <starlette.requests.Request object at 0xffff7ad61b90>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff7ad61b90>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7ad51120>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7ad51760>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad52660>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7d2b7e10>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7ad51760>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad52660>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7d451050>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7d2b7e10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad522a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad52660>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff7d2b6e50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7d451050>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad522a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad52660>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff7d450f50>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff7d2b6e50>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad522a0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad52660>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff805a00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad522a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad52660>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff7d2d5da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff7afbf210>
                     └ <function get_request_handler.<locals>.app at 0xffff7d2d68e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff80a06a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff80925260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff80924cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff7d18dad0>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaafcdd2e80,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff7d18dad0>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:10:25.849 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff81a3cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff81a3cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff81e1ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff83102050>
         │    └ <function Command.invoke at 0xffff81e1c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff83102050>
           │   │      │    └ <function main at 0xffff81a4d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8203b920>
           └ <click.core.Context object at 0xffff83102050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff81a4d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff81e27240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff81eb0720>
    └ <uvicorn.server.Server object at 0xffff820289d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff81eb07c0>
           │       │   └ <uvicorn.server.Server object at 0xffff820289d0>
           │       └ <function run at 0xffff82323d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff81a5cae0>
           │      └ <function Runner.run at 0xffff820ff9c0>
           └ <asyncio.runners.Runner object at 0xffff81a9b950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff81a81840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff81a9b950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7d2fec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad87a...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff7d2b5b50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7d2fec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad87a...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad87a...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7d131e10>
          └ <fastapi.applications.FastAPI object at 0xffff7d2b5b50>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff7ad50f40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7d131e10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7ad528e0>
                     │    │             └ <starlette.requests.Request object at 0xffff7ad87890>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff7ad87890>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7ad528e0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7ad52ca0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad52700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7d2b7e10>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7ad52ca0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad52700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7d451050>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7d2b7e10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad53420>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad52700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff7d2b6e50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7d451050>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad53420>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad52700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff7d450f50>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff7d2b6e50>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad53420>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad52700>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff805a00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad53420>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad52700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff7d2d5da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff7ad94890>
                     └ <function get_request_handler.<locals>.app at 0xffff7d2d68e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff80a06a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff80925260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff80924cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff7d18dad0>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaafcdd2e80,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff7d18dad0>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:10:25.873 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff81a3cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff81a3cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff81e1ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff83102050>
         │    └ <function Command.invoke at 0xffff81e1c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff83102050>
           │   │      │    └ <function main at 0xffff81a4d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8203b920>
           └ <click.core.Context object at 0xffff83102050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff81a4d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff81e27240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff81eb0720>
    └ <uvicorn.server.Server object at 0xffff820289d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff81eb07c0>
           │       │   └ <uvicorn.server.Server object at 0xffff820289d0>
           │       └ <function run at 0xffff82323d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff81a5cae0>
           │      └ <function Runner.run at 0xffff820ff9c0>
           └ <asyncio.runners.Runner object at 0xffff81a9b950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff81a81840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff81a9b950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7d2fec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ada8b...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff7d2b5b50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7d2fec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ada8b...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ada8b...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7d131e10>
          └ <fastapi.applications.FastAPI object at 0xffff7d2b5b50>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff7ad81d00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7d131e10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7ad80c20>
                     │    │             └ <starlette.requests.Request object at 0xffff7ada8850>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff7ada8850>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7ad80c20>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7ad81da0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad811c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7d2b7e10>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7ad81da0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad811c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7d451050>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7d2b7e10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad813a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad811c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff7d2b6e50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7d451050>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad813a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad811c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff7d450f50>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff7d2b6e50>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad813a0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad811c0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff805a00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad813a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad811c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff7d2d5da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff7ada8250>
                     └ <function get_request_handler.<locals>.app at 0xffff7d2d68e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff80a06a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff80925260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff80924cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff7d18dad0>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaafcdd2e80,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff7d18dad0>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:10:25.895 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff81a3cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff81a3cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff81e1ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff83102050>
         │    └ <function Command.invoke at 0xffff81e1c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff83102050>
           │   │      │    └ <function main at 0xffff81a4d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8203b920>
           └ <click.core.Context object at 0xffff83102050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff81a4d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff81e27240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff81eb0720>
    └ <uvicorn.server.Server object at 0xffff820289d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff81eb07c0>
           │       │   └ <uvicorn.server.Server object at 0xffff820289d0>
           │       └ <function run at 0xffff82323d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff81a5cae0>
           │      └ <function Runner.run at 0xffff820ff9c0>
           └ <asyncio.runners.Runner object at 0xffff81a9b950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff81a81840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff81a9b950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7d2fec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7adab5...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff7d2b5b50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7d2fec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7adab5...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7adab5...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7d131e10>
          └ <fastapi.applications.FastAPI object at 0xffff7d2b5b50>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff7ad827a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7d131e10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7ad823e0>
                     │    │             └ <starlette.requests.Request object at 0xffff7adaa710>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff7adaa710>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7ad823e0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7ad82b60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad82020>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7d2b7e10>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7ad82b60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad82020>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7d451050>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7d2b7e10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad81080>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad82020>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff7d2b6e50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7d451050>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad81080>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad82020>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff7d450f50>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff7d2b6e50>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad81080>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad82020>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff805a00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad81080>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad82020>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff7d2d5da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff7adaab50>
                     └ <function get_request_handler.<locals>.app at 0xffff7d2d68e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff80a06a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff80925260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff80924cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff7d18dad0>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaafcdd2e80,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff7d18dad0>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:10:25.916 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff81a3cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff81a3cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff81e1ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff83102050>
         │    └ <function Command.invoke at 0xffff81e1c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff83102050>
           │   │      │    └ <function main at 0xffff81a4d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8203b920>
           └ <click.core.Context object at 0xffff83102050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff81a4d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff81e27240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff81eb0720>
    └ <uvicorn.server.Server object at 0xffff820289d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff81eb07c0>
           │       │   └ <uvicorn.server.Server object at 0xffff820289d0>
           │       └ <function run at 0xffff82323d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff81a5cae0>
           │      └ <function Runner.run at 0xffff820ff9c0>
           └ <asyncio.runners.Runner object at 0xffff81a9b950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff81a81840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff81a9b950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7d2fec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7adaa0...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff7d2b5b50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7d2fec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7adaa0...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7adaa0...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7d131e10>
          └ <fastapi.applications.FastAPI object at 0xffff7d2b5b50>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff7ad52a20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7d131e10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7ad53ec0>
                     │    │             └ <starlette.requests.Request object at 0xffff7ad873d0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff7ad873d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7ad53ec0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7ad52840>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad52980>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7d2b7e10>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7ad52840>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad52980>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7d451050>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7d2b7e10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad528e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad52980>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff7d2b6e50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7d451050>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad528e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad52980>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff7d450f50>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff7d2b6e50>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad528e0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad52980>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff805a00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad528e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad52980>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff7d2d5da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff7ada8d50>
                     └ <function get_request_handler.<locals>.app at 0xffff7d2d68e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff80a06a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff80925260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff80924cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff7d18dad0>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaafcdd2e80,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff7d18dad0>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:10:25.936 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff81a3cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff81a3cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff81e1ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff83102050>
         │    └ <function Command.invoke at 0xffff81e1c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff83102050>
           │   │      │    └ <function main at 0xffff81a4d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8203b920>
           └ <click.core.Context object at 0xffff83102050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff81a4d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff81e27240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff81eb0720>
    └ <uvicorn.server.Server object at 0xffff820289d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff81eb07c0>
           │       │   └ <uvicorn.server.Server object at 0xffff820289d0>
           │       └ <function run at 0xffff82323d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff81a5cae0>
           │      └ <function Runner.run at 0xffff820ff9c0>
           └ <asyncio.runners.Runner object at 0xffff81a9b950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff81a81840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff81a9b950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7d2fec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad6e5...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff7d2b5b50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7d2fec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad6e5...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad6e5...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7d131e10>
          └ <fastapi.applications.FastAPI object at 0xffff7d2b5b50>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff7ad81440>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7d131e10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7ad82980>
                     │    │             └ <starlette.requests.Request object at 0xffff7ad977d0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff7ad977d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7ad82980>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7ad82e80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad828e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7d2b7e10>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7ad82e80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad828e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7d451050>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7d2b7e10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad82ac0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad828e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff7d2b6e50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7d451050>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad82ac0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad828e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff7d450f50>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff7d2b6e50>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad82ac0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad828e0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff805a00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad82ac0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad828e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff7d2d5da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff7ad97a90>
                     └ <function get_request_handler.<locals>.app at 0xffff7d2d68e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff80a06a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff80925260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff80924cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff7d18dad0>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaafcdd2e80,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff7d18dad0>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:10:25.957 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff81a3cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff81a3cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff81e1ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff83102050>
         │    └ <function Command.invoke at 0xffff81e1c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff83102050>
           │   │      │    └ <function main at 0xffff81a4d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8203b920>
           └ <click.core.Context object at 0xffff83102050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff81a4d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff81e27240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff81eb0720>
    └ <uvicorn.server.Server object at 0xffff820289d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff81eb07c0>
           │       │   └ <uvicorn.server.Server object at 0xffff820289d0>
           │       └ <function run at 0xffff82323d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff81a5cae0>
           │      └ <function Runner.run at 0xffff820ff9c0>
           └ <asyncio.runners.Runner object at 0xffff81a9b950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff81a81840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff81a9b950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7d2fec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7adb1f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff7d2b5b50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7d2fec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7adb1f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7adb1f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7d131e10>
          └ <fastapi.applications.FastAPI object at 0xffff7d2b5b50>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff7ad81d00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7d131e10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7ad82f20>
                     │    │             └ <starlette.requests.Request object at 0xffff7adb1550>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff7adb1550>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7ad82f20>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7ad81580>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad81c60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7d2b7e10>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7ad81580>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad81c60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7d451050>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7d2b7e10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad81120>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad81c60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff7d2b6e50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7d451050>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad81120>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad81c60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff7d450f50>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff7d2b6e50>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad81120>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad81c60>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff805a00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad81120>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad81c60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff7d2d5da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff7adb17d0>
                     └ <function get_request_handler.<locals>.app at 0xffff7d2d68e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff80a06a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff80925260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff80924cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff7d18dad0>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaafcdd2e80,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff7d18dad0>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:10:25.979 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff81a3cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff81a3cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff81e1ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff83102050>
         │    └ <function Command.invoke at 0xffff81e1c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff83102050>
           │   │      │    └ <function main at 0xffff81a4d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8203b920>
           └ <click.core.Context object at 0xffff83102050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff81a4d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff81e27240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff81eb0720>
    └ <uvicorn.server.Server object at 0xffff820289d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff81eb07c0>
           │       │   └ <uvicorn.server.Server object at 0xffff820289d0>
           │       └ <function run at 0xffff82323d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff81a5cae0>
           │      └ <function Runner.run at 0xffff820ff9c0>
           └ <asyncio.runners.Runner object at 0xffff81a9b950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff81a81840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff81a9b950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7d2fec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad87d...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff7d2b5b50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7d2fec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad87d...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad87d...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7d131e10>
          └ <fastapi.applications.FastAPI object at 0xffff7d2b5b50>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff7ad53ec0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7d131e10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7ad50f40>
                     │    │             └ <starlette.requests.Request object at 0xffff7ada8550>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff7ada8550>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7ad50f40>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7ad82520>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad528e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7d2b7e10>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7ad82520>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad528e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7d451050>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7d2b7e10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad52980>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad528e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff7d2b6e50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7d451050>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad52980>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad528e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff7d450f50>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff7d2b6e50>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad52980>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad528e0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff805a00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad52980>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad528e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff7d2d5da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff7ada9650>
                     └ <function get_request_handler.<locals>.app at 0xffff7d2d68e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff80a06a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff80925260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff80924cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff7d18dad0>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaafcdd2e80,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff7d18dad0>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:10:25.999 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff81a3cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff81a3cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff81e1ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff83102050>
         │    └ <function Command.invoke at 0xffff81e1c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff83102050>
           │   │      │    └ <function main at 0xffff81a4d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8203b920>
           └ <click.core.Context object at 0xffff83102050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff81a4d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff81e27240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff81eb0720>
    └ <uvicorn.server.Server object at 0xffff820289d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff81eb07c0>
           │       │   └ <uvicorn.server.Server object at 0xffff820289d0>
           │       └ <function run at 0xffff82323d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff81a5cae0>
           │      └ <function Runner.run at 0xffff820ff9c0>
           └ <asyncio.runners.Runner object at 0xffff81a9b950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff81a81840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff81a9b950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7d2fec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7adb30...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff7d2b5b50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7d2fec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7adb30...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7adb30...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7d131e10>
          └ <fastapi.applications.FastAPI object at 0xffff7d2b5b50>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff7ad83240>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7d131e10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7ad834c0>
                     │    │             └ <starlette.requests.Request object at 0xffff7adb03d0>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff7adb03d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7ad834c0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7ad832e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad828e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7d2b7e10>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7ad832e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad828e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7d451050>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7d2b7e10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad81bc0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad828e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff7d2b6e50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7d451050>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad81bc0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad828e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff7d450f50>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff7d2b6e50>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad81bc0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad828e0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff805a00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad81bc0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad828e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff7d2d5da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff7adb34d0>
                     └ <function get_request_handler.<locals>.app at 0xffff7d2d68e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff80a06a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff80925260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff80924cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff7d18dad0>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaafcdd2e80,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff7d18dad0>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:10:26.019 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff81a3cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff81a3cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff81e1ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff83102050>
         │    └ <function Command.invoke at 0xffff81e1c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff83102050>
           │   │      │    └ <function main at 0xffff81a4d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8203b920>
           └ <click.core.Context object at 0xffff83102050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff81a4d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff81e27240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff81eb0720>
    └ <uvicorn.server.Server object at 0xffff820289d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff81eb07c0>
           │       │   └ <uvicorn.server.Server object at 0xffff820289d0>
           │       └ <function run at 0xffff82323d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff81a5cae0>
           │      └ <function Runner.run at 0xffff820ff9c0>
           └ <asyncio.runners.Runner object at 0xffff81a9b950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff81a81840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff81a9b950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7d2fec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7adb94...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff7d2b5b50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7d2fec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7adb94...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7adb94...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7d131e10>
          └ <fastapi.applications.FastAPI object at 0xffff7d2b5b50>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff7ad82fc0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7d131e10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7ad80fe0>
                     │    │             └ <starlette.requests.Request object at 0xffff7adb9810>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff7adb9810>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7ad80fe0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7ad83420>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad814e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7d2b7e10>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7ad83420>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad814e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7d451050>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7d2b7e10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad82200>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad814e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff7d2b6e50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7d451050>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad82200>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad814e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff7d450f50>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff7d2b6e50>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad82200>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad814e0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff805a00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad82200>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad814e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff7d2d5da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff7adb8c50>
                     └ <function get_request_handler.<locals>.app at 0xffff7d2d68e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff80a06a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff80925260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff80924cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff7d18dad0>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaafcdd2e80,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff7d18dad0>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:10:26.040 | ERROR    | app.middleware.error_handler:general_exception_handler:54 - 未处理的异常: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0xffff81a3cae0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0xffff81a3cb80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.11/site-packages/anyio/streams/memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/usr/local/bin/uvicorn", line 8, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1485, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff81e1ca40>
           └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1406, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff83102050>
         │    └ <function Command.invoke at 0xffff81e1c720>
         └ <Command main>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 1269, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff83102050>
           │   │      │    └ <function main at 0xffff81a4d440>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8203b920>
           └ <click.core.Context object at 0xffff83102050>
  File "/usr/local/lib/python3.11/site-packages/click/core.py", line 824, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff81a4d440>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 416, in main
    run(
    └ <function run at 0xffff81e27240>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/main.py", line 587, in run
    server.run()
    │      └ <function Server.run at 0xffff81eb0720>
    └ <uvicorn.server.Server object at 0xffff820289d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff81eb07c0>
           │       │   └ <uvicorn.server.Server object at 0xffff820289d0>
           │       └ <function run at 0xffff82323d80>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff81a5cae0>
           │      └ <function Runner.run at 0xffff820ff9c0>
           └ <asyncio.runners.Runner object at 0xffff81a9b950>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff81a81840>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff81a9b950>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7d2fec10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7adb35...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff7d2b5b50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7d2fec10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7adb35...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7adb35...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7d131e10>
          └ <fastapi.applications.FastAPI object at 0xffff7d2b5b50>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff7ad53ec0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7ad...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7d131e10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7ad528e0>
                     │    │             └ <starlette.requests.Request object at 0xffff7adb0a90>
                     │    └ <bound method RateLimiterMiddleware.dispatch of <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>>
                     └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>

  File "/app/app/middleware/rate_limiter.py", line 26, in dispatch
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0xffff7adb0a90>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7ad528e0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ PydanticSerializationError(Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7ad82d40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad83d80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7d2b7e10>
          └ <app.middleware.rate_limiter.RateLimiterMiddleware object at 0xffff7d1addd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7ad82d40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad83d80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7d451050>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7d2b7e10>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad83060>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad83d80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff7d2b6e50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7d451050>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad83060>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad83d80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0xffff7d450f50>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0xffff7d2b6e50>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad83060>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad83d80>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │     └ <function Route.handle at 0xffff805a00e0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xffff7ad83060>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7ad83d80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.18.0.4', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff7d2d5da0>
          └ APIRoute(path='/api/v1/conversations', name='list_conversations', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xffff7adb3410>
                     └ <function get_request_handler.<locals>.app at 0xffff7d2d68e0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 292, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff80a06a20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 160, in serialize_response
    return field.serialize(
           │     └ <function ModelField.serialize at 0xffff80925260>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/fastapi/_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
           │    │             └ <function TypeAdapter.dump_python at 0xffff80924cc0>
           │    └ <pydantic.type_adapter.TypeAdapter object at 0xffff7d18dad0>
           └ ModelField(field_info=FieldInfo(annotation=PaginatedResponse, required=True), name='Response_list_conversations_api_v1_conver...
  File "/usr/local/lib/python3.11/site-packages/pydantic/type_adapter.py", line 314, in dump_python
    return self.serializer.to_python(
           │    │          └ <method 'to_python' of 'pydantic_core._pydantic_core.SchemaSerializer' objects>
           │    └ SchemaSerializer(serializer=Model(
           │          ModelSerializer {
           │              class: Py(
           │                  0x0000aaaafcdd2e80,
           │              ),
           │            ...
           └ <pydantic.type_adapter.TypeAdapter object at 0xffff7d18dad0>

pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.conversation.Conversation'>
2025-11-24 03:10:26.072 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 03:24:58.555 | INFO     | app.main:lifespan:53 - 应用关闭中...
2025-11-24 03:24:58.559 | INFO     | app.main:lifespan:57 - 数据库连接已关闭
2025-11-24 03:24:58.560 | INFO     | app.main:lifespan:61 - Redis 连接已关闭
2025-11-24 03:24:59.478 | INFO     | app.main:lifespan:38 - 应用启动中...
2025-11-24 03:24:59.478 | INFO     | app.main:lifespan:42 - 数据库连接已建立
2025-11-24 03:24:59.479 | INFO     | app.main:lifespan:46 - Redis 连接已建立
2025-11-24 03:24:59.479 | INFO     | app.main:lifespan:48 - Medical AI Platform v1.0.0 启动成功
2025-11-24 03:26:32.940 | INFO     | app.services.conversation_service:create_conversation:39 - 创建会话: 36739b77-5bcb-4415-9dbb-cebdb5b0e7a1, 用户: c18c593f-8fd4-48ce-b1d5-33cd6c1af922
2025-11-24 03:26:33.180 | ERROR    | app.middleware.error_handler:api_exception_handler:15 - API 异常: Token 已失效，请重新登录, 详情: None
2025-11-24 09:10:03.514 | INFO     | app.main:lifespan:53 - 应用关闭中...
2025-11-24 09:10:03.537 | INFO     | app.main:lifespan:57 - 数据库连接已关闭
2025-11-24 09:10:03.539 | INFO     | app.main:lifespan:61 - Redis 连接已关闭
